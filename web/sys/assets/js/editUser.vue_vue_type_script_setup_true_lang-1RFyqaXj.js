import{h as K,i as Q,j as X,k as Y}from"./index-Bt4iVw3F.js";import{a as C}from"./element-plus-BcbsnzDt.js";import{d as ee,b as k,Z as le,_ as ae,j as te,o as i,c as f,U as e,O as a,u as s,D as se,ai as u,i as oe,a as v,S as g,T as _,M as b,R as V,F as R,a8 as q}from"./@vue-CIdpUgdv.js";const de={class:"system-edit-user-container"},re={key:0},ue={key:0},me={class:"dialog-footer"},ce=ee({name:"systemEditUser",__name:"editUser",props:{deptData:{type:Array,default:()=>[]},genderData:{type:Array,default:()=>[]}},emits:["getUserList"],setup(N,{expose:E,emit:B}){const w=B,{proxy:P}=oe(),y=k([]),U=k([]),h=k(null),p=le({isShowDialog:!1,ruleForm:{userId:0,deptId:0,userName:"",nickName:"",password:"",mobile:"",email:"",sex:"",status:1,remark:"",postIds:[],roleIds:[],isAdmin:0},rules:{userName:[{required:!0,message:"用户名称不能为空",trigger:"blur"}],nickName:[{required:!0,message:"用户昵称不能为空",trigger:"blur"}],deptId:[{required:!0,message:"归属部门不能为空",trigger:"blur"}],password:[{required:!0,message:"用户密码不能为空",trigger:"blur"}],email:[{type:"email",message:"'请输入正确的邮箱地址",trigger:["blur","change"]}],mobile:[{required:!0,message:"手机号码不能为空",trigger:"blur"},{pattern:/^1[3|4|5|6|7|8|9][0-9]\d{8}$/,message:"请输入正确的手机号码",trigger:"blur"}]}}),{ruleForm:o,isShowDialog:x,rules:T}=ae(p),z=n=>{W(),n&&K(n.id).then(t=>{const d=t.data.user;p.ruleForm={userId:d.id,deptId:d.deptId,userName:d.userName,nickName:d.userNickname,password:"-",mobile:d.mobile,email:d.userEmail,sex:String(d.sex),status:d.userStatus,remark:d.remark,postIds:t.data.checkedPosts??[],roleIds:t.data.checkedRoleIds??[],isAdmin:d.isAdmin}}),p.isShowDialog=!0},I=()=>{p.isShowDialog=!1},M=()=>{I()},j=()=>{const n=s(h);n&&n.validate(t=>{t&&(p.ruleForm.userId===0?X(p.ruleForm).then(()=>{C.success("用户添加成功"),I(),w("getUserList")}):Y(p.ruleForm).then(()=>{C.success("用户修改成功"),I(),w("getUserList")}))})},O=()=>{Q().then(n=>{const t=n.data.roleList??[],d=n.data.roleAccess??[];t.map(r=>{d.includes(r.id)||(r.disabled=!0)}),y.value=P.handleTree(t??[],"id","pid","children",!0),U.value=n.data.posts??[]})};te(()=>{O()});const W=()=>{p.ruleForm={userId:0,deptId:0,userName:"",nickName:"",password:"",mobile:"",email:"",sex:"",status:1,remark:"",postIds:[],roleIds:[],isAdmin:0}};return E({openDialog:z}),(n,t)=>{const d=u("el-input"),r=u("el-form-item"),m=u("el-col"),D=u("el-cascader"),S=u("el-option"),A=u("el-select"),Z=u("el-switch"),F=u("el-radio"),$=u("el-radio-group"),G=u("el-row"),H=u("el-form"),L=u("el-button"),J=u("el-dialog");return i(),f("div",de,[e(J,{title:(s(o).userId!==0?"修改":"添加")+"用户",modelValue:s(x),"onUpdate:modelValue":t[12]||(t[12]=l=>se(x)?x.value=l:null),width:"769px"},{footer:a(()=>[v("span",me,[e(L,{onClick:M,size:"default"},{default:a(()=>[g("取 消")]),_:1}),e(L,{type:"primary",onClick:j,size:"default"},{default:a(()=>[g(_(s(o).userId!==0?"修 改":"添 加"),1)]),_:1})])]),default:a(()=>[e(H,{ref_key:"formRef",ref:h,model:s(o),rules:s(T),size:"default","label-width":"90px"},{default:a(()=>[e(G,{gutter:35},{default:a(()=>[s(o).userId===0?(i(),b(m,{key:0,xs:24,sm:12,md:12,lg:12,xl:12},{default:a(()=>[e(r,{label:"用户名",prop:"userName"},{default:a(()=>[e(d,{modelValue:s(o).userName,"onUpdate:modelValue":t[0]||(t[0]=l=>s(o).userName=l),placeholder:"请输入账户名称",clearable:""},null,8,["modelValue"])]),_:1})]),_:1})):V("",!0),s(o).userId===0?(i(),b(m,{key:1,xs:24,sm:12,md:12,lg:12,xl:12},{default:a(()=>[e(r,{label:"账户密码",prop:"password"},{default:a(()=>[e(d,{modelValue:s(o).password,"onUpdate:modelValue":t[1]||(t[1]=l=>s(o).password=l),placeholder:"请输入",type:"password",clearable:""},null,8,["modelValue"])]),_:1})]),_:1})):V("",!0),e(m,{xs:24,sm:12,md:12,lg:12,xl:12},{default:a(()=>[e(r,{label:"用户昵称",prop:"nickName"},{default:a(()=>[e(d,{modelValue:s(o).nickName,"onUpdate:modelValue":t[2]||(t[2]=l=>s(o).nickName=l),placeholder:"请输入用户昵称",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(m,{xs:24,sm:12,md:12,lg:12,xl:12},{default:a(()=>[e(r,{label:"关联角色",prop:"roleIds"},{default:a(()=>[e(D,{options:y.value,props:{checkStrictly:!0,emitPath:!1,value:"id",label:"name",multiple:!0},placeholder:"请选择角色",clearable:"",class:"w100",modelValue:s(o).roleIds,"onUpdate:modelValue":t[3]||(t[3]=l=>s(o).roleIds=l)},{default:a(({node:l,data:c})=>[v("span",null,_(c.name),1),l.isLeaf?V("",!0):(i(),f("span",re," ("+_(c.children.length)+") ",1))]),_:1},8,["options","modelValue"])]),_:1})]),_:1}),e(m,{xs:24,sm:12,md:12,lg:12,xl:12},{default:a(()=>[e(r,{label:"部门",prop:"deptId"},{default:a(()=>[e(D,{options:N.deptData,props:{checkStrictly:!0,emitPath:!1,value:"deptId",label:"deptName"},placeholder:"请选择部门",clearable:"",class:"w100",modelValue:s(o).deptId,"onUpdate:modelValue":t[4]||(t[4]=l=>s(o).deptId=l)},{default:a(({node:l,data:c})=>[v("span",null,_(c.deptName),1),l.isLeaf?V("",!0):(i(),f("span",ue," ("+_(c.children.length)+") ",1))]),_:1},8,["options","modelValue"])]),_:1})]),_:1}),e(m,{xs:24,sm:12,md:12,lg:12,xl:12},{default:a(()=>[e(r,{label:"手机号",prop:"mobile"},{default:a(()=>[e(d,{modelValue:s(o).mobile,"onUpdate:modelValue":t[5]||(t[5]=l=>s(o).mobile=l),placeholder:"请输入手机号",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(m,{xs:24,sm:12,md:12,lg:12,xl:12},{default:a(()=>[e(r,{label:"邮箱",prop:"email"},{default:a(()=>[e(d,{modelValue:s(o).email,"onUpdate:modelValue":t[6]||(t[6]=l=>s(o).email=l),placeholder:"请输入",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(m,{xs:24,sm:12,md:12,lg:12,xl:12},{default:a(()=>[e(r,{label:"性别",prop:"sex"},{default:a(()=>[e(A,{modelValue:s(o).sex,"onUpdate:modelValue":t[7]||(t[7]=l=>s(o).sex=l),placeholder:"请选择",clearable:"",class:"w100"},{default:a(()=>[(i(!0),f(R,null,q(N.genderData,l=>(i(),b(S,{key:"gender-"+l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(m,{xs:24,sm:12,md:12,lg:12,xl:12},{default:a(()=>[e(r,{label:"岗位",prop:"postIds"},{default:a(()=>[e(A,{modelValue:s(o).postIds,"onUpdate:modelValue":t[8]||(t[8]=l=>s(o).postIds=l),placeholder:"请选择",clearable:"",class:"w100",multiple:""},{default:a(()=>[(i(!0),f(R,null,q(U.value,l=>(i(),b(S,{key:"post-"+l.postId,label:l.postName,value:l.postId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(m,{xs:24,sm:12,md:12,lg:12,xl:12},{default:a(()=>[e(r,{label:"用户状态"},{default:a(()=>[e(Z,{modelValue:s(o).status,"onUpdate:modelValue":t[9]||(t[9]=l=>s(o).status=l),"inline-prompt":"","active-value":1,"inactive-value":0,"active-text":"启","inactive-text":"禁"},null,8,["modelValue"])]),_:1})]),_:1}),e(m,{span:24},{default:a(()=>[e(r,{label:"用户类型"},{default:a(()=>[e($,{modelValue:s(o).isAdmin,"onUpdate:modelValue":t[10]||(t[10]=l=>s(o).isAdmin=l)},{default:a(()=>[e(F,{value:1},{default:a(()=>[g("后台管理员")]),_:1}),e(F,{value:0},{default:a(()=>[g("前台用户")]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(m,{xs:24,sm:24,md:24,lg:24,xl:24},{default:a(()=>[e(r,{label:"用户描述"},{default:a(()=>[e(d,{modelValue:s(o).remark,"onUpdate:modelValue":t[11]||(t[11]=l=>s(o).remark=l),type:"textarea",placeholder:"请输入用户描述",maxlength:"150"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"])])}}});export{ce as _};
