import{I as G}from"./index-tv3EQEJT.js";import{l as J,m as Q,n as X,o as Y,p as $}from"./index-Cf93PWEY.js";import{a as C}from"./element-plus-BcbsnzDt.js";import{d as ee,b as le,Z as ae,_ as oe,o as c,c as V,U as e,O as l,u as a,D as te,n as de,ai as p,a as S,S as m,T as x,R as k,F,a8 as ne,M as ue,i as se}from"./@vue-CIdpUgdv.js";const ie={class:"system-edit-menu-container"},me={key:0},re={key:0},pe={class:"dialog-footer"},Ve=ee({name:"systemEditMenu",__name:"editMenu",props:{visibleOptions:{type:Array,default:()=>[]},acType:{type:String,default:()=>"add"}},emits:["menuList"],setup(y,{expose:D,emit:N}){const v=y,I=N,L=le(null),{proxy:A}=se(),s=ae({loading:!1,isShowDialog:!1,roles:[],ruleForm:{id:void 0,pid:0,menuType:"0",menuName:"",name:"",component:"",isLink:0,menuSort:0,path:"",redirect:"",icon:"",roles:[],isHide:"0",isKeepAlive:1,isAffix:0,linkUrl:"",isIframe:0},rules:{parentId:[{required:!0,message:"父菜单不能为空",trigger:"blur"}],name:[{required:!0,message:"接口规则不能为空",trigger:"blur"}],path:[{required:!0,message:"路由地址不能为空",trigger:"blur"}],menuName:[{required:!0,message:"菜单名称不能为空",trigger:"blur"}],menuType:[{required:!0,message:"菜单类型不能为空",trigger:"blur"}]},menuData:[]}),{ruleForm:d,rules:M,menuData:H,loading:R,isShowDialog:U,roles:q}=oe(s),B=f=>{O(),de(()=>{Q().then(o=>{const n=o.data.roles??[];s.roles=A.handleTree(n??[],"id","pid","children",!0);const u={id:0,title:"主类目",children:[]};u.children=A.handleTree(o.data.menus,"id","pid"),s.menuData=new Array(u)}),f&&(v.acType==="add"?s.ruleForm.pid=f.id:v.acType==="edit"&&X(f.id).then(o=>{const n=o.data.rule;s.ruleForm={id:n.id,pid:n.pid,menuType:""+n.menuType,menuName:n.title,name:n.name,component:n.component,isLink:n.isLink,menuSort:n.weigh,path:n.path,redirect:n.redirect,icon:n.icon,roles:o.data.roleIds,isHide:""+n.isHide,isKeepAlive:n.isCached,isAffix:n.isAffix,linkUrl:n.linkUrl,isIframe:n.isIframe}})),s.isShowDialog=!0,s.loading=!1})},T=()=>{s.isShowDialog=!1},K=()=>{s.ruleForm.isIframe===1?s.ruleForm.isLink=1:s.ruleForm.isLink=0},E=()=>{T()},z=()=>{const f=a(L);f&&f.validate(o=>{o&&(s.loading=!0,v.acType==="add"?Y(s.ruleForm).then(()=>{C.success("菜单添加成功"),T(),h(),I("menuList")}).finally(()=>{s.loading=!1}):$(s.ruleForm).then(()=>{C.success("菜单修改成功"),T(),h(),I("menuList")}).finally(()=>{s.loading=!1}))})},h=()=>{J()},O=()=>{s.ruleForm={id:void 0,pid:0,menuType:"0",menuName:"",name:"",component:"",isLink:0,menuSort:0,path:"",redirect:"",icon:"",roles:[],isHide:"0",isKeepAlive:1,isAffix:0,linkUrl:"",isIframe:0}};return D({openDialog:B,resetMenuSession:h}),(f,o)=>{const n=p("el-cascader"),u=p("el-form-item"),i=p("el-col"),r=p("el-radio"),_=p("el-radio-group"),g=p("el-input"),P=p("el-input-number"),W=p("el-row"),Z=p("el-form"),w=p("el-button"),j=p("el-dialog");return c(),V("div",ie,[e(j,{title:(y.acType==="add"?"新增":"修改")+"菜单",modelValue:a(U),"onUpdate:modelValue":o[16]||(o[16]=t=>te(U)?U.value=t:null),width:"769px","close-on-click-modal":!1},{footer:l(()=>[S("span",pe,[e(w,{onClick:E,size:"default"},{default:l(()=>[m("取 消")]),_:1}),e(w,{type:"primary",onClick:z,size:"default",loading:a(R)},{default:l(()=>[m(x(y.acType==="add"?"新 增":"修 改"),1)]),_:1},8,["loading"])])]),default:l(()=>[e(Z,{model:a(d),rules:a(M),ref_key:"ruleFormRef",ref:L,size:"default","label-width":"80px"},{default:l(()=>[e(W,{gutter:35},{default:l(()=>[e(i,{xs:24,sm:24,md:24,lg:24,xl:24},{default:l(()=>[e(u,{label:"上级菜单"},{default:l(()=>[e(n,{options:a(H),props:{label:"title",value:"id",checkStrictly:!0,emitPath:!1},placeholder:"请选择上级菜单",clearable:"",class:"w100",modelValue:a(d).pid,"onUpdate:modelValue":o[0]||(o[0]=t=>a(d).pid=t)},{default:l(({node:t,data:b})=>[S("span",null,x(b.title),1),t.isLeaf?k("",!0):(c(),V("span",me," ("+x(b.children.length)+") ",1))]),_:1},8,["options","modelValue"])]),_:1})]),_:1}),e(i,{xs:24,sm:24,md:24,lg:24,xl:24},{default:l(()=>[e(u,{label:"菜单类型",prop:"menuType"},{default:l(()=>[e(_,{modelValue:a(d).menuType,"onUpdate:modelValue":o[1]||(o[1]=t=>a(d).menuType=t)},{default:l(()=>[e(r,{value:"0"},{default:l(()=>[m("目录")]),_:1}),e(r,{value:"1"},{default:l(()=>[m("菜单")]),_:1}),e(r,{value:"2"},{default:l(()=>[m("按钮")]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(i,{xs:24,sm:12,md:12,lg:12,xl:12},{default:l(()=>[e(u,{label:"菜单名称",prop:"menuName"},{default:l(()=>[e(g,{modelValue:a(d).menuName,"onUpdate:modelValue":o[2]||(o[2]=t=>a(d).menuName=t),placeholder:"请填写菜单名称",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(i,{xs:24,sm:12,md:12,lg:12,xl:12},{default:l(()=>[e(u,{label:"接口规则",prop:"name"},{default:l(()=>[e(g,{modelValue:a(d).name,"onUpdate:modelValue":o[3]||(o[3]=t=>a(d).name=t),placeholder:"后端 aip 地址",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),a(d).menuType==="0"||a(d).menuType==="1"?(c(),V(F,{key:0},[e(i,{xs:24,sm:12,md:12,lg:12,xl:12},{default:l(()=>[e(u,{label:"路由路径",prop:"path"},{default:l(()=>[e(g,{modelValue:a(d).path,"onUpdate:modelValue":o[4]||(o[4]=t=>a(d).path=t),placeholder:"路由中的 path 值",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(i,{xs:24,sm:12,md:12,lg:12,xl:12},{default:l(()=>[e(u,{label:"重定向"},{default:l(()=>[e(g,{modelValue:a(d).redirect,"onUpdate:modelValue":o[5]||(o[5]=t=>a(d).redirect=t),placeholder:"请输入路由重定向",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(i,{xs:24,sm:12,md:12,lg:12,xl:12},{default:l(()=>[e(u,{label:"菜单图标"},{default:l(()=>[e(G,{placeholder:"请输入菜单图标",modelValue:a(d).icon,"onUpdate:modelValue":o[6]||(o[6]=t=>a(d).icon=t),type:"all"},null,8,["modelValue"])]),_:1})]),_:1}),e(i,{xs:24,sm:12,md:12,lg:12,xl:12},{default:l(()=>[e(u,{label:"组件路径",prop:"component"},{default:l(()=>[e(g,{modelValue:a(d).component,"onUpdate:modelValue":o[7]||(o[7]=t=>a(d).component=t),placeholder:"组件路径",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(i,{xs:24,sm:12,md:12,lg:12,xl:12},{default:l(()=>[e(u,{label:"链接地址"},{default:l(()=>[e(g,{modelValue:a(d).linkUrl,"onUpdate:modelValue":o[8]||(o[8]=t=>a(d).linkUrl=t),placeholder:"外链/内嵌时链接地址（http:xxx.com）",clearable:"",disabled:a(d).isLink===0},null,8,["modelValue","disabled"])]),_:1})]),_:1})],64)):k("",!0),e(i,{xs:24,sm:12,md:12,lg:12,xl:12},{default:l(()=>[e(u,{label:"权限标识"},{default:l(()=>[e(n,{options:a(q),props:{checkStrictly:!0,emitPath:!1,value:"id",label:"name",multiple:!0},placeholder:"请选择角色",clearable:"",class:"w100",modelValue:a(d).roles,"onUpdate:modelValue":o[9]||(o[9]=t=>a(d).roles=t)},{default:l(({node:t,data:b})=>[S("span",null,x(b.name),1),t.isLeaf?k("",!0):(c(),V("span",re," ("+x(b.children.length)+") ",1))]),_:1},8,["options","modelValue"])]),_:1})]),_:1}),e(i,{xs:24,sm:12,md:12,lg:12,xl:12},{default:l(()=>[e(u,{label:"菜单排序"},{default:l(()=>[e(P,{modelValue:a(d).menuSort,"onUpdate:modelValue":o[10]||(o[10]=t=>a(d).menuSort=t),"controls-position":"right",placeholder:"请输入排序",class:"w100"},null,8,["modelValue"])]),_:1})]),_:1}),a(d).menuType==="0"||a(d).menuType==="1"?(c(),V(F,{key:1},[e(i,{xs:24,sm:12,md:12,lg:12,xl:12},{default:l(()=>[e(u,{label:"是否隐藏"},{default:l(()=>[e(_,{modelValue:a(d).isHide,"onUpdate:modelValue":o[11]||(o[11]=t=>a(d).isHide=t)},{default:l(()=>[(c(!0),V(F,null,ne(y.visibleOptions,t=>(c(),ue(r,{key:t.value,value:t.value},{default:l(()=>[m(x(t.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(i,{xs:24,sm:12,md:12,lg:12,xl:12},{default:l(()=>[e(u,{label:"页面缓存"},{default:l(()=>[e(_,{modelValue:a(d).isKeepAlive,"onUpdate:modelValue":o[12]||(o[12]=t=>a(d).isKeepAlive=t)},{default:l(()=>[e(r,{value:1},{default:l(()=>[m("缓存")]),_:1}),e(r,{value:0},{default:l(()=>[m("不缓存")]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(i,{xs:24,sm:12,md:12,lg:12,xl:12},{default:l(()=>[e(u,{label:"是否固定"},{default:l(()=>[e(_,{modelValue:a(d).isAffix,"onUpdate:modelValue":o[13]||(o[13]=t=>a(d).isAffix=t)},{default:l(()=>[e(r,{value:1},{default:l(()=>[m("固定")]),_:1}),e(r,{value:0},{default:l(()=>[m("不固定")]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(i,{xs:24,sm:12,md:12,lg:12,xl:12},{default:l(()=>[e(u,{label:"是否外链"},{default:l(()=>[e(_,{modelValue:a(d).isLink,"onUpdate:modelValue":o[14]||(o[14]=t=>a(d).isLink=t),disabled:a(d).isIframe===1},{default:l(()=>[e(r,{value:1},{default:l(()=>[m("是")]),_:1}),e(r,{value:0},{default:l(()=>[m("否")]),_:1})]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1}),e(i,{xs:24,sm:12,md:12,lg:12,xl:12},{default:l(()=>[e(u,{label:"是否内嵌"},{default:l(()=>[e(_,{modelValue:a(d).isIframe,"onUpdate:modelValue":o[15]||(o[15]=t=>a(d).isIframe=t),onChange:K},{default:l(()=>[e(r,{value:1},{default:l(()=>[m("是")]),_:1}),e(r,{value:0},{default:l(()=>[m("否")]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})],64)):k("",!0)]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"])])}}});export{Ve as _};
