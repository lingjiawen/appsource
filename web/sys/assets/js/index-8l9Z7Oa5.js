import{g as y,a as V}from"./index-Cf93PWEY.js";import{a as I}from"./axios-CdtiCRuU.js";import{d as z,a as b,E as A}from"./element-plus-BcbsnzDt.js";import{d as D,b as H,Z as M,o as C,c as L,U as l,O as a,ai as r,aq as j,P as O,S as p,T as P,a as u,bl as q,bj as N}from"./@vue-CIdpUgdv.js";const X=()=>window.location.origin;function Z(o,m,x="get"){o=X()+o;const _=z.service({lock:!0,text:"正在生成导出数据...",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"});let n={url:o,params:m,timeout:3e5,method:"get",responseType:"blob",headers:{Authorization:"Bearer "+y()}};x=="post"&&(n={url:o,data:m,timeout:3e5,method:"post",responseType:"blob",headers:{Authorization:"Bearer "+y()}}),I(n).then(s=>{if(_.close(),s.status!==200){b({message:"发生错误，导出失败。",type:"error"});return}try{const t=document.createElement("a");var g=new Blob([s.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),U=new RegExp("filename=([^;]+\\.[^\\.;]+);*"),e=decodeURI(s.headers["content-disposition"]||s.headers["Content-Disposition"]),v=U.exec(e),c=v[1];c=c.replace(/"/g,""),t.href=URL.createObjectURL(g),t.setAttribute("download",c),document.body.appendChild(t),t.click(),document.body.appendChild(t)}catch(t){console.log(t),b({message:"下载失败，可能您登录状态过期，请重新登录后下载。",type:"error"})}}).catch(s=>{console.log(s),_.close(),b({message:"导出失败",type:"error"})})}const B=o=>(q("data-v-fe1961df"),o=o(),N(),o),$={class:"excel-uploader"},G=B(()=>u("div",{class:"el-upload__text"},[p("将文件拖到此处，或"),u("em",null,"点击上传")],-1)),J={class:"text-center el-upload__tip"},K=B(()=>u("span",null,"仅允许导入xls、xlsx格式文件。",-1)),Q={class:"dialog-footer"},W=D({__name:"index",props:["upUrl","tplUrl"],emits:["getList"],setup(o,{expose:m,emit:x}){const _="/",n=H(),s=x,g=o,e=M({open:!1,title:"excel导入",isUploading:!1,headers:{Authorization:"Bearer "+y()},url:_+g.upUrl}),v=()=>{e.isUploading=!0},c=(d,i)=>{var h;e.open=!1,e.isUploading=!1,(h=n.value)==null||h.handleRemove(i);let f="导入成功！";d.code!==0&&(f=d.message),A.alert("<div style='overflow: auto;overflow-x: hidden;max-height: 70vh;padding: 10px 20px 0;'>"+f+"</div>","导入结果",{dangerouslyUseHTMLString:!0}),s("getList")},t=()=>{Z(g.tplUrl,{},"get")},E=()=>{var d;(d=n.value)==null||d.submit()};return m({open:()=>{e.open=!0}}),(d,i)=>{const f=r("ele-UploadFilled"),h=r("el-icon"),R=r("el-link"),S=r("el-upload"),k=r("el-button"),T=r("el-dialog"),F=j("drag");return C(),L("div",$,[l(T,{modelValue:e.open,"onUpdate:modelValue":i[1]||(i[1]=w=>e.open=w),width:"500px","close-on-click-modal":!1,"destroy-on-close":!0},{header:a(()=>[O((C(),L("div",null,[p(P(e.title),1)])),[[F,[".excel-uploader .el-dialog",".excel-uploader .el-dialog__header"]]])]),footer:a(()=>[u("div",Q,[l(k,{type:"primary",onClick:E},{default:a(()=>[p("确 定")]),_:1}),l(k,{onClick:i[0]||(i[0]=w=>e.open=!1)},{default:a(()=>[p("取 消")]),_:1})])]),default:a(()=>[l(S,{ref_key:"uploadRef",ref:n,limit:1,accept:".xlsx, .xls",headers:e.headers,action:e.url,disabled:e.isUploading,"on-progress":v,"on-success":c,"auto-upload":!1,drag:"",class:"up-selector"},{tip:a(()=>[u("div",J,[K,l(R,{type:"primary",underline:!1,style:{"font-size":"12px","vertical-align":"baseline"},onClick:t},{default:a(()=>[p("下载模板")]),_:1})])]),default:a(()=>[l(h,{class:"el-icon--upload"},{default:a(()=>[l(f)]),_:1}),G]),_:1},8,["headers","action","disabled"])]),_:1},8,["modelValue"])])}}}),se=V(W,[["__scopeId","data-v-fe1961df"]]);export{Z as d,se as l};
