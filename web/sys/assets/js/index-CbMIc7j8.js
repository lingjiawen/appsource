import{M as G}from"./@element-plus-jSNvwxF2.js";import{e as H,f as J,g as X}from"./index-Bt4iVw3F.js";import{d as W,Z as Y,_ as q,i as K,o as D,c as V,U as t,O as a,P as x,V as ee,ai as o,M as j,R as Q,S as h,b as k,k as T,j as te,e as z,n as ae,F as le,a8 as oe,T as M,a as R,a9 as ne}from"./@vue-CIdpUgdv.js";import{a as Z}from"./index-Cf93PWEY.js";const se=W({name:"systemUserList",props:{deptData:{type:Array,default:()=>[]},param:{type:Object,default:()=>{}},genderData:{type:Array,default:()=>[]},multiple:{type:Boolean,default:!0}},emits:["ok","okBatch"],components:{},setup(e,{emit:n}){const{proxy:v,props:g}=K(),{sys_user_sex:C}=v.useDict("sys_user_sex"),f=Y({ids:[],userItem:[],deptProps:{id:"deptId",children:"children",label:"deptName"},tableData:{data:[],total:0,loading:!1,param:{pageNum:1,pageSize:10,roleId:void 0,deptId:"",mobile:"",status:"",keyWords:"",dateRange:[]}}});return{sys_user_sex:C,setUserList:()=>{const u={...f.tableData.param,...g.param};H(u).then(i=>{f.tableData.data=i.data.userList??[],f.tableData.total=i.data.total})},onOpenSelectUser:u=>{n("ok",u)},handleSelectionChange:u=>{n("okBatch",u)},...q(f)}}}),re={class:"system-user-list-container",style:{"min-height":"600px"}};function de(e,n,v,g,C,f){const c=o("el-table-column"),p=o("el-button"),_=o("el-table"),u=o("pagination");return D(),V("div",re,[t(_,{data:e.tableData.data,style:{width:"100%"},onSelectionChange:e.handleSelectionChange},{default:a(()=>[e.multiple?(D(),j(c,{key:0,type:"selection",width:"55",align:"center"})):Q("",!0),t(c,{type:"index",label:"序号",width:"60"}),t(c,{prop:"userNickname",label:"姓名","show-overflow-tooltip":""}),t(c,{label:"操作",width:"100"},{default:a(i=>[t(p,{size:"small",text:"",type:"primary",onClick:y=>e.onOpenSelectUser(i.row)},{default:a(()=>[h("选择")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data","onSelectionChange"]),x(t(u,{total:e.tableData.total,page:e.tableData.param.pageNum,"onUpdate:page":n[0]||(n[0]=i=>e.tableData.param.pageNum=i),limit:e.tableData.param.pageSize,"onUpdate:limit":n[1]||(n[1]=i=>e.tableData.param.pageSize=i),onPagination:e.setUserList},null,8,["total","page","limit","onPagination"]),[[ee,e.tableData.total>0]])])}const ue=Z(se,[["render",de]]),ie=W({name:"systemUser",components:{UserList:ue},props:{multiple:{type:Boolean,default:!0},modelValue:{type:Array,default:()=>[]}},emits:["update:modelValue"],setup(e,{emit:n}){const v=k(1),g=k(!1),{proxy:C}=K(),{sys_user_sex:f}=C.useDict("sys_user_sex"),c=k(),p=k(),_=k(""),u=k(),i=G,y=k([]),s=T({get:()=>e.modelValue??[],set:l=>{n("update:modelValue",l)}}),m=T(()=>{let l=(v.value-1)*10,d=l+10;return y.value.slice(l,d)}),b=()=>{e.modelValue&&e.modelValue.length>0?J({ids:e.modelValue}).then(l=>{l.code===0&&(y.value=l.data.userList)}):y.value=[]};te(()=>{b()}),z(s,(l,d)=>{l!=d&&b()});const F=Y({ids:[],deptProps:{id:"deptId",children:"children",label:"deptName"},deptData:[],param:{deptId:"",mobile:"",status:"",keyWords:"",dateRange:[]}}),U=()=>{c.value.setUserList()},S=()=>{X().then(l=>{F.deptData=l.data.deps}),U()};z(_,l=>{u.value.filter(l)});const w=(l,d)=>l?d.deptName.includes(l):!0,E=l=>{F.param.deptId=l.deptId,U()},N=l=>{l&&(l.resetFields(),U())},B=()=>{g.value=!0,ae(()=>{S()})};return{selectedUsersPage:v,visible:g,queryRef:p,userListRef:c,deptFilterNode:w,filterText:_,treeRef:u,search:i,sys_user_sex:f,selectedUsers:s,deptUser:y,selectedUserInfo:m,openDialog:B,getUserList:U,handleSelectUserOk:l=>{e.multiple?s.value.includes(l.id)||(s.value=[...s.value,l.id]):s.value=[l.id]},handleSelectUserOkBatch:l=>{if(e.multiple){const d=[];l.forEach(A=>{s.value.includes(A.id)||d.push(A.id)}),d.length>0&&(s.value=[...s.value,...d])}},handleNodeClick:E,resetQuery:N,goBack:()=>{g.value=!1},removeAll:()=>{s.value=[]},remove:l=>{s.value=s.value.filter(d=>d!==l)},handleClose:l=>{s.value=s.value.filter(d=>d!==l)},handleSelectUser:()=>{B()},...q(F)}}}),pe={key:0},ce={class:"system-user-container"},me={class:"system-user-search mb15"},fe={style:{height:"32px","line-height":"32px"}};function _e(e,n,v,g,C,f){const c=o("el-tag"),p=o("el-button"),_=o("el-input"),u=o("el-tree"),i=o("el-scrollbar"),y=o("el-aside"),s=o("el-card"),m=o("el-col"),b=o("el-form-item"),F=o("el-date-picker"),U=o("ele-Search"),S=o("el-icon"),w=o("ele-Refresh"),E=o("el-form"),N=o("UserList"),B=o("el-table-column"),O=o("el-table"),L=o("el-row"),$=o("el-pagination"),I=o("el-dialog");return D(),V("div",null,[e.deptUser.length>0?(D(),V("div",pe,[(D(!0),V(le,null,oe(e.deptUser,r=>(D(),j(c,{closable:"","disable-transitions":!1,class:"u-m-r-10",key:"sel_"+r.id,onClose:P=>e.handleClose(r.id)},{default:a(()=>[h(M(r.userNickname),1)]),_:2},1032,["onClose"]))),128))])):Q("",!0),t(p,{style:{"padding-left":"10px"},type:"primary",link:"",onClick:e.handleSelectUser},{default:a(()=>[h("请选择")]),_:1},8,["onClick"]),t(I,{title:"选择用户",modelValue:e.visible,"onUpdate:modelValue":n[5]||(n[5]=r=>e.visible=r),width:"80%",top:"5vh","append-to-body":"","close-on-click-modal":!1},{default:a(()=>[R("div",ce,[t(L,{gutter:10,style:{width:"100%"}},{default:a(()=>[t(m,{span:6},{default:a(()=>[t(s,{shadow:"hover"},{default:a(()=>[t(y,null,{default:a(()=>[t(i,null,{default:a(()=>[t(_,{"prefix-icon":e.search,modelValue:e.filterText,"onUpdate:modelValue":n[0]||(n[0]=r=>e.filterText=r),placeholder:"请输入部门名称",clearable:"",style:{width:"80%"}},null,8,["prefix-icon","modelValue"]),t(u,{ref:"treeRef",class:"filter-tree",data:e.deptData,props:e.deptProps,"default-expand-all":"","filter-node-method":e.deptFilterNode,onNodeClick:e.handleNodeClick},null,8,["data","props","filter-node-method","onNodeClick"])]),_:1})]),_:1})]),_:1})]),_:1}),t(m,{span:12},{default:a(()=>[t(s,{shadow:"hover"},{default:a(()=>[R("div",me,[t(E,{model:e.param,ref:"queryRef",inline:!0,"label-width":"68px"},{default:a(()=>[t(b,{label:"关键字",prop:"keyWords"},{default:a(()=>[t(_,{modelValue:e.param.keyWords,"onUpdate:modelValue":n[1]||(n[1]=r=>e.param.keyWords=r),placeholder:"请输入姓名",clearable:"",style:{width:"240px"},onKeyup:ne(e.getUserList,["enter","native"])},null,8,["modelValue","onKeyup"])]),_:1}),t(b,{label:"创建时间",prop:"dateRange"},{default:a(()=>[t(F,{modelValue:e.param.dateRange,"onUpdate:modelValue":n[2]||(n[2]=r=>e.param.dateRange=r),style:{width:"240px"},"value-format":"YYYY-MM-DD",type:"daterange","range-separator":"-","start-placeholder":"开始日期","end-placeholder":"结束日期"},null,8,["modelValue"])]),_:1}),t(b,null,{default:a(()=>[t(p,{size:"default",type:"primary",class:"ml10",onClick:e.getUserList},{default:a(()=>[t(S,null,{default:a(()=>[t(U)]),_:1}),h(" 查询 ")]),_:1},8,["onClick"]),t(p,{size:"default",onClick:n[3]||(n[3]=r=>e.resetQuery(e.queryRef))},{default:a(()=>[t(S,null,{default:a(()=>[t(w)]),_:1}),h(" 重置 ")]),_:1})]),_:1})]),_:1},8,["model"])]),t(N,{ref:"userListRef","dept-data":e.deptData,"gender-data":e.sys_user_sex,param:e.param,multiple:e.multiple,onOk:e.handleSelectUserOk,onOkBatch:e.handleSelectUserOkBatch},null,8,["dept-data","gender-data","param","multiple","onOk","onOkBatch"])]),_:1})]),_:1}),t(m,{span:6},{default:a(()=>[t(s,{shadow:"hover"},{default:a(()=>[t(L,{gutter:10},{default:a(()=>[t(m,{span:10},{default:a(()=>[R("p",fe,"已选择："+M(e.selectedUsers.length),1)]),_:1}),t(m,{span:7},{default:a(()=>[t(p,{type:"success",plain:"",onClick:e.goBack},{default:a(()=>[h("确认返回")]),_:1},8,["onClick"])]),_:1}),t(m,{span:7},{default:a(()=>[t(p,{type:"danger",plain:"",onClick:e.removeAll},{default:a(()=>[h("全部移除")]),_:1},8,["onClick"])]),_:1}),t(m,{span:24},{default:a(()=>[t(O,{data:e.selectedUserInfo},{default:a(()=>[t(B,{label:"操作"},{default:a(r=>[t(p,{type:"danger",plain:"",onClick:P=>e.remove(r.row.id)},{default:a(()=>[h("移除")]),_:2},1032,["onClick"])]),_:1}),t(B,{prop:"userNickname",label:"姓名"})]),_:1},8,["data"])]),_:1})]),_:1}),t($,{layout:"prev, pager, next",total:e.selectedUsers.length,"current-page":e.selectedUsersPage,"onUpdate:currentPage":n[4]||(n[4]=r=>e.selectedUsersPage=r)},null,8,["total","current-page"])]),_:1})]),_:1})]),_:1})])]),_:1},8,["modelValue"])])}const be=Z(ie,[["render",_e],["__scopeId","data-v-0c7e6784"]]);export{be as s};
