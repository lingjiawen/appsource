import{V as j,D as f,E as y,c as Le,a as Ae,g as R,S as b,F as G,b as U,C as x,d as k,P as De,f as Re,e as J,s as Y,h as fe,i as de,R as Pe,r as We,j as Fe,W as Ee,l as Te,k as Ie,m as qe,n as $e,o as Oe,p as Be,q as Ke,t as ze,u as He,v as Ne,w as Ve,x as _e,y as Qe,z as je,A as Ge,B as Ue,G as Je,H as Ye,I as Ze,J as Xe,K as et,L as tt,M as it}from"./@codemirror-ByA0xLDA.js";function u(){var t=arguments[0];typeof t=="string"&&(t=document.createElement(t));var e=1,i=arguments[1];if(i&&typeof i=="object"&&i.nodeType==null&&!Array.isArray(i)){for(var s in i)if(Object.prototype.hasOwnProperty.call(i,s)){var n=i[s];typeof n=="string"?t.setAttribute(s,n):n!=null&&(t[s]=n)}e++}for(;e<arguments.length;e++)me(t,arguments[e]);return t}function me(t,e){if(typeof e=="string")t.appendChild(document.createTextNode(e));else if(e!=null)if(e.nodeType!=null)t.appendChild(e);else if(Array.isArray(e))for(var i=0;i<e.length;i++)me(t,e[i]);else throw new RangeError("Unsupported child node: "+e)}const oe=typeof String.prototype.normalize=="function"?t=>t.normalize("NFKD"):t=>t;class A{constructor(e,i,s=0,n=e.length,r,l){this.test=l,this.value={from:0,to:0},this.done=!1,this.matches=[],this.buffer="",this.bufferPos=0,this.iter=e.iterRange(s,n),this.bufferStart=s,this.normalize=r?o=>r(oe(o)):oe,this.query=this.normalize(i)}peek(){if(this.bufferPos==this.buffer.length){if(this.bufferStart+=this.buffer.length,this.iter.next(),this.iter.done)return-1;this.bufferPos=0,this.buffer=this.iter.value}return Le(this.buffer,this.bufferPos)}next(){for(;this.matches.length;)this.matches.pop();return this.nextOverlapping()}nextOverlapping(){for(;;){let e=this.peek();if(e<0)return this.done=!0,this;let i=Re(e),s=this.bufferStart+this.bufferPos;this.bufferPos+=Ae(e);let n=this.normalize(i);for(let r=0,l=s;;r++){let o=n.charCodeAt(r),a=this.match(o,l);if(a)return this.value=a,this;if(r==n.length-1)break;l==s&&r<i.length&&i.charCodeAt(r)==o&&l++}}}match(e,i){let s=null;for(let n=0;n<this.matches.length;n+=2){let r=this.matches[n],l=!1;this.query.charCodeAt(r)==e&&(r==this.query.length-1?s={from:this.matches[n+1],to:i+1}:(this.matches[n]++,l=!0)),l||(this.matches.splice(n,2),n-=2)}return this.query.charCodeAt(0)==e&&(this.query.length==1?s={from:i,to:i+1}:this.matches.push(1,i)),s&&this.test&&!this.test(s.from,s.to,this.buffer,this.bufferPos)&&(s=null),s}}typeof Symbol<"u"&&(A.prototype[Symbol.iterator]=function(){return this});const ge={from:-1,to:-1,match:/.*/.exec("")},Z="gm"+(/x/.unicode==null?"":"u");class pe{constructor(e,i,s,n=0,r=e.length){if(this.text=e,this.to=r,this.curLine="",this.done=!1,this.value=ge,/\\[sWDnr]|\n|\r|\[\^/.test(i))return new xe(e,i,s,n,r);this.re=new RegExp(i,Z+(s!=null&&s.ignoreCase?"i":"")),this.test=s==null?void 0:s.test,this.iter=e.iter();let l=e.lineAt(n);this.curLineStart=l.from,this.matchPos=T(e,n),this.getLine(this.curLineStart)}getLine(e){this.iter.next(e),this.iter.lineBreak?this.curLine="":(this.curLine=this.iter.value,this.curLineStart+this.curLine.length>this.to&&(this.curLine=this.curLine.slice(0,this.to-this.curLineStart)),this.iter.next())}nextLine(){this.curLineStart=this.curLineStart+this.curLine.length+1,this.curLineStart>this.to?this.curLine="":this.getLine(0)}next(){for(let e=this.matchPos-this.curLineStart;;){this.re.lastIndex=e;let i=this.matchPos<=this.to&&this.re.exec(this.curLine);if(i){let s=this.curLineStart+i.index,n=s+i[0].length;if(this.matchPos=T(this.text,n+(s==n?1:0)),s==this.curLineStart+this.curLine.length&&this.nextLine(),(s<n||s>this.value.to)&&(!this.test||this.test(s,n,i)))return this.value={from:s,to:n,match:i},this;e=this.matchPos-this.curLineStart}else if(this.curLineStart+this.curLine.length<this.to)this.nextLine(),e=0;else return this.done=!0,this}}}const H=new WeakMap;class L{constructor(e,i){this.from=e,this.text=i}get to(){return this.from+this.text.length}static get(e,i,s){let n=H.get(e);if(!n||n.from>=s||n.to<=i){let o=new L(i,e.sliceString(i,s));return H.set(e,o),o}if(n.from==i&&n.to==s)return n;let{text:r,from:l}=n;return l>i&&(r=e.sliceString(i,l)+r,l=i),n.to<s&&(r+=e.sliceString(n.to,s)),H.set(e,new L(l,r)),new L(i,r.slice(i-l,s-l))}}class xe{constructor(e,i,s,n,r){this.text=e,this.to=r,this.done=!1,this.value=ge,this.matchPos=T(e,n),this.re=new RegExp(i,Z+(s!=null&&s.ignoreCase?"i":"")),this.test=s==null?void 0:s.test,this.flat=L.get(e,n,this.chunkEnd(n+5e3))}chunkEnd(e){return e>=this.to?this.to:this.text.lineAt(e).to}next(){for(;;){let e=this.re.lastIndex=this.matchPos-this.flat.from,i=this.re.exec(this.flat.text);if(i&&!i[0]&&i.index==e&&(this.re.lastIndex=e+1,i=this.re.exec(this.flat.text)),i){let s=this.flat.from+i.index,n=s+i[0].length;if((this.flat.to>=this.to||i.index+i[0].length<=this.flat.text.length-10)&&(!this.test||this.test(s,n,i)))return this.value={from:s,to:n,match:i},this.matchPos=T(this.text,n+(s==n?1:0)),this}if(this.flat.to==this.to)return this.done=!0,this;this.flat=L.get(this.text,this.flat.from,this.chunkEnd(this.flat.from+this.flat.text.length*2))}}}typeof Symbol<"u"&&(pe.prototype[Symbol.iterator]=xe.prototype[Symbol.iterator]=function(){return this});function st(t){try{return new RegExp(t,Z),!0}catch{return!1}}function T(t,e){if(e>=t.length)return e;let i=t.lineAt(e),s;for(;e<i.to&&(s=i.text.charCodeAt(e-i.from))>=56320&&s<57344;)e++;return e}function _(t){let e=u("input",{class:"cm-textfield",name:"line"}),i=u("form",{class:"cm-gotoLine",onkeydown:n=>{n.keyCode==27?(n.preventDefault(),t.dispatch({effects:I.of(!1)}),t.focus()):n.keyCode==13&&(n.preventDefault(),s())},onsubmit:n=>{n.preventDefault(),s()}},u("label",t.state.phrase("Go to line"),": ",e)," ",u("button",{class:"cm-button",type:"submit"},t.state.phrase("go")));function s(){let n=/^([+-])?(\d+)?(:\d+)?(%)?$/.exec(e.value);if(!n)return;let{state:r}=t,l=r.doc.lineAt(r.selection.main.head),[,o,a,c,h]=n,d=c?+c.slice(1):0,p=a?+a:l.number;if(a&&h){let z=p/100;o&&(z=z*(o=="-"?-1:1)+l.number/r.doc.lines),p=Math.round(r.doc.lines*z)}else a&&o&&(p=p*(o=="-"?-1:1)+l.number);let re=r.doc.line(Math.max(1,Math.min(r.doc.lines,p)));t.dispatch({effects:I.of(!1),selection:k.cursor(re.from+Math.max(0,Math.min(d,re.length))),scrollIntoView:!0}),t.focus()}return{dom:i}}const I=b.define(),le=J.define({create(){return!0},update(t,e){for(let i of e.effects)i.is(I)&&(t=i.value);return t},provide:t=>Y.from(t,e=>e?_:null)}),nt=t=>{let e=R(t,_);if(!e){let i=[I.of(!0)];t.state.field(le,!1)==null&&i.push(b.appendConfig.of([le,rt])),t.dispatch({effects:i}),e=R(t,_)}return e&&e.dom.querySelector("input").focus(),!0},rt=y.baseTheme({".cm-panel.cm-gotoLine":{padding:"2px 6px 4px","& label":{fontSize:"80%"}}}),ot={highlightWordAroundCursor:!1,minSelectionLength:1,maxMatches:100,wholeWords:!1},lt=G.define({combine(t){return U(t,ot,{highlightWordAroundCursor:(e,i)=>e||i,minSelectionLength:Math.min,maxMatches:Math.min})}});function at(t){return[dt,ft]}const ct=f.mark({class:"cm-selectionMatch"}),ht=f.mark({class:"cm-selectionMatch cm-selectionMatch-main"});function ae(t,e,i,s){return(i==0||t(e.sliceDoc(i-1,i))!=x.Word)&&(s==e.doc.length||t(e.sliceDoc(s,s+1))!=x.Word)}function ut(t,e,i,s){return t(e.sliceDoc(i,i+1))==x.Word&&t(e.sliceDoc(s-1,s))==x.Word}const ft=j.fromClass(class{constructor(t){this.decorations=this.getDeco(t)}update(t){(t.selectionSet||t.docChanged||t.viewportChanged)&&(this.decorations=this.getDeco(t.view))}getDeco(t){let e=t.state.facet(lt),{state:i}=t,s=i.selection;if(s.ranges.length>1)return f.none;let n=s.main,r,l=null;if(n.empty){if(!e.highlightWordAroundCursor)return f.none;let a=i.wordAt(n.head);if(!a)return f.none;l=i.charCategorizer(n.head),r=i.sliceDoc(a.from,a.to)}else{let a=n.to-n.from;if(a<e.minSelectionLength||a>200)return f.none;if(e.wholeWords){if(r=i.sliceDoc(n.from,n.to),l=i.charCategorizer(n.head),!(ae(l,i,n.from,n.to)&&ut(l,i,n.from,n.to)))return f.none}else if(r=i.sliceDoc(n.from,n.to).trim(),!r)return f.none}let o=[];for(let a of t.visibleRanges){let c=new A(i.doc,r,a.from,a.to);for(;!c.next().done;){let{from:h,to:d}=c.value;if((!l||ae(l,i,h,d))&&(n.empty&&h<=n.from&&d>=n.to?o.push(ht.range(h,d)):(h>=n.to||d<=n.from)&&o.push(ct.range(h,d)),o.length>e.maxMatches))return f.none}}return f.set(o)}},{decorations:t=>t.decorations}),dt=y.baseTheme({".cm-selectionMatch":{backgroundColor:"#99ff7780"},".cm-searchMatch .cm-selectionMatch":{backgroundColor:"transparent"}}),mt=({state:t,dispatch:e})=>{let{selection:i}=t,s=k.create(i.ranges.map(n=>t.wordAt(n.head)||k.cursor(n.head)),i.mainIndex);return s.eq(i)?!1:(e(t.update({selection:s})),!0)};function gt(t,e){let{main:i,ranges:s}=t.selection,n=t.wordAt(i.head),r=n&&n.from==i.from&&n.to==i.to;for(let l=!1,o=new A(t.doc,e,s[s.length-1].to);;)if(o.next(),o.done){if(l)return null;o=new A(t.doc,e,0,Math.max(0,s[s.length-1].from-1)),l=!0}else{if(l&&s.some(a=>a.from==o.value.from))continue;if(r){let a=t.wordAt(o.value.from);if(!a||a.from!=o.value.from||a.to!=o.value.to)continue}return o.value}}const pt=({state:t,dispatch:e})=>{let{ranges:i}=t.selection;if(i.some(r=>r.from===r.to))return mt({state:t,dispatch:e});let s=t.sliceDoc(i[0].from,i[0].to);if(t.selection.ranges.some(r=>t.sliceDoc(r.from,r.to)!=s))return!1;let n=gt(t,s);return n?(e(t.update({selection:t.selection.addRange(k.range(n.from,n.to),!1),effects:y.scrollIntoView(n.to)})),!0):!1},X=G.define({combine(t){return U(t,{top:!1,caseSensitive:!1,literal:!1,wholeWord:!1,createPanel:e=>new Dt(e)})}});class ye{constructor(e){this.search=e.search,this.caseSensitive=!!e.caseSensitive,this.literal=!!e.literal,this.regexp=!!e.regexp,this.replace=e.replace||"",this.valid=!!this.search&&(!this.regexp||st(this.search)),this.unquoted=this.unquote(this.search),this.wholeWord=!!e.wholeWord}unquote(e){return this.literal?e:e.replace(/\\([nrt\\])/g,(i,s)=>s=="n"?`
`:s=="r"?"\r":s=="t"?"	":"\\")}eq(e){return this.search==e.search&&this.replace==e.replace&&this.caseSensitive==e.caseSensitive&&this.regexp==e.regexp&&this.wholeWord==e.wholeWord}create(){return this.regexp?new St(this):new yt(this)}getCursor(e,i=0,s){let n=e.doc?e:fe.create({doc:e});return s==null&&(s=n.doc.length),this.regexp?C(this,n,i,s):w(this,n,i,s)}}class be{constructor(e){this.spec=e}}function w(t,e,i,s){return new A(e.doc,t.unquoted,i,s,t.caseSensitive?void 0:n=>n.toLowerCase(),t.wholeWord?xt(e.doc,e.charCategorizer(e.selection.main.head)):void 0)}function xt(t,e){return(i,s,n,r)=>((r>i||r+n.length<s)&&(r=Math.max(0,i-2),n=t.sliceString(r,Math.min(t.length,s+2))),(e(q(n,i-r))!=x.Word||e($(n,i-r))!=x.Word)&&(e($(n,s-r))!=x.Word||e(q(n,s-r))!=x.Word))}class yt extends be{constructor(e){super(e)}nextMatch(e,i,s){let n=w(this.spec,e,s,e.doc.length).nextOverlapping();return n.done&&(n=w(this.spec,e,0,i).nextOverlapping()),n.done?null:n.value}prevMatchInRange(e,i,s){for(let n=s;;){let r=Math.max(i,n-1e4-this.spec.unquoted.length),l=w(this.spec,e,r,n),o=null;for(;!l.nextOverlapping().done;)o=l.value;if(o)return o;if(r==i)return null;n-=1e4}}prevMatch(e,i,s){return this.prevMatchInRange(e,0,i)||this.prevMatchInRange(e,s,e.doc.length)}getReplacement(e){return this.spec.unquote(this.spec.replace)}matchAll(e,i){let s=w(this.spec,e,0,e.doc.length),n=[];for(;!s.next().done;){if(n.length>=i)return null;n.push(s.value)}return n}highlight(e,i,s,n){let r=w(this.spec,e,Math.max(0,i-this.spec.unquoted.length),Math.min(s+this.spec.unquoted.length,e.doc.length));for(;!r.next().done;)n(r.value.from,r.value.to)}}function C(t,e,i,s){return new pe(e.doc,t.search,{ignoreCase:!t.caseSensitive,test:t.wholeWord?bt(e.charCategorizer(e.selection.main.head)):void 0},i,s)}function q(t,e){return t.slice(de(t,e,!1),e)}function $(t,e){return t.slice(e,de(t,e))}function bt(t){return(e,i,s)=>!s[0].length||(t(q(s.input,s.index))!=x.Word||t($(s.input,s.index))!=x.Word)&&(t($(s.input,s.index+s[0].length))!=x.Word||t(q(s.input,s.index+s[0].length))!=x.Word)}class St extends be{nextMatch(e,i,s){let n=C(this.spec,e,s,e.doc.length).next();return n.done&&(n=C(this.spec,e,0,i).next()),n.done?null:n.value}prevMatchInRange(e,i,s){for(let n=1;;n++){let r=Math.max(i,s-n*1e4),l=C(this.spec,e,r,s),o=null;for(;!l.next().done;)o=l.value;if(o&&(r==i||o.from>r+10))return o;if(r==i)return null}}prevMatch(e,i,s){return this.prevMatchInRange(e,0,i)||this.prevMatchInRange(e,s,e.doc.length)}getReplacement(e){return this.spec.unquote(this.spec.replace.replace(/\$([$&\d+])/g,(i,s)=>s=="$"?"$":s=="&"?e.match[0]:s!="0"&&+s<e.match.length?e.match[s]:i))}matchAll(e,i){let s=C(this.spec,e,0,e.doc.length),n=[];for(;!s.next().done;){if(n.length>=i)return null;n.push(s.value)}return n}highlight(e,i,s,n){let r=C(this.spec,e,Math.max(0,i-250),Math.min(s+250,e.doc.length));for(;!r.next().done;)n(r.value.from,r.value.to)}}const P=b.define(),ee=b.define(),S=J.define({create(t){return new N(Q(t).create(),null)},update(t,e){for(let i of e.effects)i.is(P)?t=new N(i.value.create(),t.panel):i.is(ee)&&(t=new N(t.query,i.value?te:null));return t},provide:t=>Y.from(t,e=>e.panel)});class N{constructor(e,i){this.query=e,this.panel=i}}const kt=f.mark({class:"cm-searchMatch"}),vt=f.mark({class:"cm-searchMatch cm-searchMatch-selected"}),wt=j.fromClass(class{constructor(t){this.view=t,this.decorations=this.highlight(t.state.field(S))}update(t){let e=t.state.field(S);(e!=t.startState.field(S)||t.docChanged||t.selectionSet||t.viewportChanged)&&(this.decorations=this.highlight(e))}highlight({query:t,panel:e}){if(!e||!t.spec.valid)return f.none;let{view:i}=this,s=new Pe;for(let n=0,r=i.visibleRanges,l=r.length;n<l;n++){let{from:o,to:a}=r[n];for(;n<l-1&&a>r[n+1].from-2*250;)a=r[++n].to;t.highlight(i.state,o,a,(c,h)=>{let d=i.state.selection.ranges.some(p=>p.from==c&&p.to==h);s.add(c,h,d?vt:kt)})}return s.finish()}},{decorations:t=>t.decorations});function W(t){return e=>{let i=e.state.field(S,!1);return i&&i.query.spec.valid?t(e,i):Se(e)}}const O=W((t,{query:e})=>{let{to:i}=t.state.selection.main,s=e.nextMatch(t.state,i,i);return s?(t.dispatch({selection:{anchor:s.from,head:s.to},scrollIntoView:!0,effects:ie(t,s),userEvent:"select.search"}),!0):!1}),B=W((t,{query:e})=>{let{state:i}=t,{from:s}=i.selection.main,n=e.prevMatch(i,s,s);return n?(t.dispatch({selection:{anchor:n.from,head:n.to},scrollIntoView:!0,effects:ie(t,n),userEvent:"select.search"}),!0):!1}),Ct=W((t,{query:e})=>{let i=e.matchAll(t.state,1e3);return!i||!i.length?!1:(t.dispatch({selection:k.create(i.map(s=>k.range(s.from,s.to))),userEvent:"select.search.matches"}),!0)}),Mt=({state:t,dispatch:e})=>{let i=t.selection;if(i.ranges.length>1||i.main.empty)return!1;let{from:s,to:n}=i.main,r=[],l=0;for(let o=new A(t.doc,t.sliceDoc(s,n));!o.next().done;){if(r.length>1e3)return!1;o.value.from==s&&(l=r.length),r.push(k.range(o.value.from,o.value.to))}return e(t.update({selection:k.create(r,l),userEvent:"select.search.matches"})),!0},ce=W((t,{query:e})=>{let{state:i}=t,{from:s,to:n}=i.selection.main;if(i.readOnly)return!1;let r=e.nextMatch(i,s,s);if(!r)return!1;let l=[],o,a,c=[];if(r.from==s&&r.to==n&&(a=i.toText(e.getReplacement(r)),l.push({from:r.from,to:r.to,insert:a}),r=e.nextMatch(i,r.from,r.to),c.push(y.announce.of(i.phrase("replaced match on line $",i.doc.lineAt(s).number)+"."))),r){let h=l.length==0||l[0].from>=r.to?0:r.to-r.from-a.length;o={anchor:r.from-h,head:r.to-h},c.push(ie(t,r))}return t.dispatch({changes:l,selection:o,scrollIntoView:!!o,effects:c,userEvent:"input.replace"}),!0}),Lt=W((t,{query:e})=>{if(t.state.readOnly)return!1;let i=e.matchAll(t.state,1e9).map(n=>{let{from:r,to:l}=n;return{from:r,to:l,insert:e.getReplacement(n)}});if(!i.length)return!1;let s=t.state.phrase("replaced $ matches",i.length)+".";return t.dispatch({changes:i,effects:y.announce.of(s),userEvent:"input.replace.all"}),!0});function te(t){return t.state.facet(X).createPanel(t)}function Q(t,e){var i,s,n,r;let l=t.selection.main,o=l.empty||l.to>l.from+100?"":t.sliceDoc(l.from,l.to);if(e&&!o)return e;let a=t.facet(X);return new ye({search:((i=e==null?void 0:e.literal)!==null&&i!==void 0?i:a.literal)?o:o.replace(/\n/g,"\\n"),caseSensitive:(s=e==null?void 0:e.caseSensitive)!==null&&s!==void 0?s:a.caseSensitive,literal:(n=e==null?void 0:e.literal)!==null&&n!==void 0?n:a.literal,wholeWord:(r=e==null?void 0:e.wholeWord)!==null&&r!==void 0?r:a.wholeWord})}const Se=t=>{let e=t.state.field(S,!1);if(e&&e.panel){let i=R(t,te);if(!i)return!1;let s=i.dom.querySelector("[main-field]");if(s&&s!=t.root.activeElement){let n=Q(t.state,e.query.spec);n.valid&&t.dispatch({effects:P.of(n)}),s.focus(),s.select()}}else t.dispatch({effects:[ee.of(!0),e?P.of(Q(t.state,e.query.spec)):b.appendConfig.of(Pt)]});return!0},ke=t=>{let e=t.state.field(S,!1);if(!e||!e.panel)return!1;let i=R(t,te);return i&&i.dom.contains(t.root.activeElement)&&t.focus(),t.dispatch({effects:ee.of(!1)}),!0},At=[{key:"Mod-f",run:Se,scope:"editor search-panel"},{key:"F3",run:O,shift:B,scope:"editor search-panel",preventDefault:!0},{key:"Mod-g",run:O,shift:B,scope:"editor search-panel",preventDefault:!0},{key:"Escape",run:ke,scope:"editor search-panel"},{key:"Mod-Shift-l",run:Mt},{key:"Alt-g",run:nt},{key:"Mod-d",run:pt,preventDefault:!0}];class Dt{constructor(e){this.view=e;let i=this.query=e.state.field(S).query.spec;this.commit=this.commit.bind(this),this.searchField=u("input",{value:i.search,placeholder:m(e,"Find"),"aria-label":m(e,"Find"),class:"cm-textfield",name:"search",form:"","main-field":"true",onchange:this.commit,onkeyup:this.commit}),this.replaceField=u("input",{value:i.replace,placeholder:m(e,"Replace"),"aria-label":m(e,"Replace"),class:"cm-textfield",name:"replace",form:"",onchange:this.commit,onkeyup:this.commit}),this.caseField=u("input",{type:"checkbox",name:"case",form:"",checked:i.caseSensitive,onchange:this.commit}),this.reField=u("input",{type:"checkbox",name:"re",form:"",checked:i.regexp,onchange:this.commit}),this.wordField=u("input",{type:"checkbox",name:"word",form:"",checked:i.wholeWord,onchange:this.commit});function s(n,r,l){return u("button",{class:"cm-button",name:n,onclick:r,type:"button"},l)}this.dom=u("div",{onkeydown:n=>this.keydown(n),class:"cm-search"},[this.searchField,s("next",()=>O(e),[m(e,"next")]),s("prev",()=>B(e),[m(e,"previous")]),s("select",()=>Ct(e),[m(e,"all")]),u("label",null,[this.caseField,m(e,"match case")]),u("label",null,[this.reField,m(e,"regexp")]),u("label",null,[this.wordField,m(e,"by word")]),...e.state.readOnly?[]:[u("br"),this.replaceField,s("replace",()=>ce(e),[m(e,"replace")]),s("replaceAll",()=>Lt(e),[m(e,"replace all")])],u("button",{name:"close",onclick:()=>ke(e),"aria-label":m(e,"close"),type:"button"},["×"])])}commit(){let e=new ye({search:this.searchField.value,caseSensitive:this.caseField.checked,regexp:this.reField.checked,wholeWord:this.wordField.checked,replace:this.replaceField.value});e.eq(this.query)||(this.query=e,this.view.dispatch({effects:P.of(e)}))}keydown(e){We(this.view,e,"search-panel")?e.preventDefault():e.keyCode==13&&e.target==this.searchField?(e.preventDefault(),(e.shiftKey?B:O)(this.view)):e.keyCode==13&&e.target==this.replaceField&&(e.preventDefault(),ce(this.view))}update(e){for(let i of e.transactions)for(let s of i.effects)s.is(P)&&!s.value.eq(this.query)&&this.setQuery(s.value)}setQuery(e){this.query=e,this.searchField.value=e.search,this.replaceField.value=e.replace,this.caseField.checked=e.caseSensitive,this.reField.checked=e.regexp,this.wordField.checked=e.wholeWord}mount(){this.searchField.select()}get pos(){return 80}get top(){return this.view.state.facet(X).top}}function m(t,e){return t.state.phrase(e)}const F=30,E=/[\s\.,:;?!]/;function ie(t,{from:e,to:i}){let s=t.state.doc.lineAt(e),n=t.state.doc.lineAt(i).to,r=Math.max(s.from,e-F),l=Math.min(n,i+F),o=t.state.sliceDoc(r,l);if(r!=s.from){for(let a=0;a<F;a++)if(!E.test(o[a+1])&&E.test(o[a])){o=o.slice(a);break}}if(l!=n){for(let a=o.length-1;a>o.length-F;a--)if(!E.test(o[a-1])&&E.test(o[a])){o=o.slice(0,a);break}}return y.announce.of(`${t.state.phrase("current match")}. ${o} ${t.state.phrase("on line")} ${s.number}.`)}const Rt=y.baseTheme({".cm-panel.cm-search":{padding:"2px 6px 4px",position:"relative","& [name=close]":{position:"absolute",top:"0",right:"4px",backgroundColor:"inherit",border:"none",font:"inherit",padding:0,margin:0},"& input, & button, & label":{margin:".2em .6em .2em 0"},"& input[type=checkbox]":{marginRight:".2em"},"& label":{fontSize:"80%",whiteSpace:"pre"}},"&light .cm-searchMatch":{backgroundColor:"#ffff0054"},"&dark .cm-searchMatch":{backgroundColor:"#00ffff8a"},"&light .cm-searchMatch-selected":{backgroundColor:"#ff6a0054"},"&dark .cm-searchMatch-selected":{backgroundColor:"#ff00ff8a"}}),Pt=[S,De.lowest(wt),Rt];class Wt{constructor(e,i,s){this.from=e,this.to=i,this.diagnostic=s}}class v{constructor(e,i,s){this.diagnostics=e,this.panel=i,this.selected=s}static init(e,i,s){let n=e,r=s.facet(M).markerFilter;r&&(n=r(n));let l=f.set(n.map(o=>o.from==o.to||o.from==o.to-1&&s.doc.lineAt(o.from).to==o.from?f.widget({widget:new zt(o),diagnostic:o}).range(o.from):f.mark({attributes:{class:"cm-lintRange cm-lintRange-"+o.severity},diagnostic:o}).range(o.from,o.to)),!0);return new v(l,i,D(l))}}function D(t,e=null,i=0){let s=null;return t.between(i,1e9,(n,r,{spec:l})=>{if(!(e&&l.diagnostic!=e))return s=new Wt(n,r,l.diagnostic),!1}),s}function Ft(t,e){return!!(t.effects.some(i=>i.is(se))||t.changes.touchesRange(e.pos))}function ve(t,e){return t.field(g,!1)?e:e.concat(b.appendConfig.of([g,y.decorations.compute([g],i=>{let{selected:s,panel:n}=i.field(g);return!s||!n||s.from==s.to?f.none:f.set([Tt.range(s.from,s.to)])}),Fe(It,{hideOn:Ft}),Nt]))}function Et(t,e){return{effects:ve(t,[se.of(e)])}}const se=b.define(),ne=b.define(),we=b.define(),g=J.define({create(){return new v(f.none,null,null)},update(t,e){if(e.docChanged){let i=t.diagnostics.map(e.changes),s=null;if(t.selected){let n=e.changes.mapPos(t.selected.from,1);s=D(i,t.selected.diagnostic,n)||D(i,null,n)}t=new v(i,t.panel,s)}for(let i of e.effects)i.is(se)?t=v.init(i.value,t.panel,e.state):i.is(ne)?t=new v(t.diagnostics,i.value?K.open:null,t.selected):i.is(we)&&(t=new v(t.diagnostics,t.panel,i.value));return t},provide:t=>[Y.from(t,e=>e.panel),y.decorations.from(t,e=>e.diagnostics)]}),Tt=f.mark({class:"cm-lintRange cm-lintRange-active"});function It(t,e,i){let{diagnostics:s}=t.state.field(g),n=[],r=2e8,l=0;s.between(e-(i<0?1:0),e+(i>0?1:0),(a,c,{spec:h})=>{e>=a&&e<=c&&(a==c||(e>a||i>0)&&(e<c||i<0))&&(n.push(h.diagnostic),r=Math.min(a,r),l=Math.max(c,l))});let o=t.state.facet(M).tooltipFilter;return o&&(n=o(n)),n.length?{pos:r,end:l,above:t.state.doc.lineAt(r).to<l,create(){return{dom:qt(t,n)}}}:null}function qt(t,e){return u("ul",{class:"cm-tooltip-lint"},e.map(i=>Me(t,i,!1)))}const $t=t=>{let e=t.state.field(g,!1);(!e||!e.panel)&&t.dispatch({effects:ve(t.state,[ne.of(!0)])});let i=R(t,K.open);return i&&i.dom.querySelector(".cm-panel-lint ul").focus(),!0},he=t=>{let e=t.state.field(g,!1);return!e||!e.panel?!1:(t.dispatch({effects:ne.of(!1)}),!0)},Ot=t=>{let e=t.state.field(g,!1);if(!e)return!1;let i=t.state.selection.main,s=e.diagnostics.iter(i.to+1);return!s.value&&(s=e.diagnostics.iter(0),!s.value||s.from==i.from&&s.to==i.to)?!1:(t.dispatch({selection:{anchor:s.from,head:s.to},scrollIntoView:!0}),!0)},Bt=[{key:"Mod-Shift-m",run:$t,preventDefault:!0},{key:"F8",run:Ot}],Kt=j.fromClass(class{constructor(t){this.view=t,this.timeout=-1,this.set=!0;let{delay:e}=t.state.facet(M);this.lintTime=Date.now()+e,this.run=this.run.bind(this),this.timeout=setTimeout(this.run,e)}run(){let t=Date.now();if(t<this.lintTime-10)setTimeout(this.run,this.lintTime-t);else{this.set=!1;let{state:e}=this.view,{sources:i}=e.facet(M);Promise.all(i.map(s=>Promise.resolve(s(this.view)))).then(s=>{let n=s.reduce((r,l)=>r.concat(l));this.view.state.doc==e.doc&&this.view.dispatch(Et(this.view.state,n))},s=>{Te(this.view.state,s)})}}update(t){let e=t.state.facet(M);(t.docChanged||e!=t.startState.facet(M))&&(this.lintTime=Date.now()+e.delay,this.set||(this.set=!0,this.timeout=setTimeout(this.run,e.delay)))}force(){this.set&&(this.lintTime=Date.now(),this.run())}destroy(){clearTimeout(this.timeout)}}),M=G.define({combine(t){return Object.assign({sources:t.map(e=>e.source)},U(t.map(e=>e.config),{delay:750,markerFilter:null,tooltipFilter:null}))},enables:Kt});function Ce(t){let e=[];if(t)e:for(let{name:i}of t){for(let s=0;s<i.length;s++){let n=i[s];if(/[a-zA-Z]/.test(n)&&!e.some(r=>r.toLowerCase()==n.toLowerCase())){e.push(n);continue e}}e.push("")}return e}function Me(t,e,i){var s;let n=i?Ce(e.actions):[];return u("li",{class:"cm-diagnostic cm-diagnostic-"+e.severity},u("span",{class:"cm-diagnosticText"},e.renderMessage?e.renderMessage():e.message),(s=e.actions)===null||s===void 0?void 0:s.map((r,l)=>{let o=d=>{d.preventDefault();let p=D(t.state.field(g).diagnostics,e);p&&r.apply(t,p.from,p.to)},{name:a}=r,c=n[l]?a.indexOf(n[l]):-1,h=c<0?a:[a.slice(0,c),u("u",a.slice(c,c+1)),a.slice(c+1)];return u("button",{type:"button",class:"cm-diagnosticAction",onclick:o,onmousedown:o,"aria-label":` Action: ${a}${c<0?"":` (access key "${n[l]})"`}.`},h)}),e.source&&u("div",{class:"cm-diagnosticSource"},e.source))}class zt extends Ee{constructor(e){super(),this.diagnostic=e}eq(e){return e.diagnostic==this.diagnostic}toDOM(){return u("span",{class:"cm-lintPoint cm-lintPoint-"+this.diagnostic.severity})}}class ue{constructor(e,i){this.diagnostic=i,this.id="item_"+Math.floor(Math.random()*4294967295).toString(16),this.dom=Me(e,i,!0),this.dom.id=this.id,this.dom.setAttribute("role","option")}}class K{constructor(e){this.view=e,this.items=[];let i=n=>{if(n.keyCode==27)he(this.view),this.view.focus();else if(n.keyCode==38||n.keyCode==33)this.moveSelection((this.selectedIndex-1+this.items.length)%this.items.length);else if(n.keyCode==40||n.keyCode==34)this.moveSelection((this.selectedIndex+1)%this.items.length);else if(n.keyCode==36)this.moveSelection(0);else if(n.keyCode==35)this.moveSelection(this.items.length-1);else if(n.keyCode==13)this.view.focus();else if(n.keyCode>=65&&n.keyCode<=90&&this.selectedIndex>=0){let{diagnostic:r}=this.items[this.selectedIndex],l=Ce(r.actions);for(let o=0;o<l.length;o++)if(l[o].toUpperCase().charCodeAt(0)==n.keyCode){let a=D(this.view.state.field(g).diagnostics,r);a&&r.actions[o].apply(e,a.from,a.to)}}else return;n.preventDefault()},s=n=>{for(let r=0;r<this.items.length;r++)this.items[r].dom.contains(n.target)&&this.moveSelection(r)};this.list=u("ul",{tabIndex:0,role:"listbox","aria-label":this.view.state.phrase("Diagnostics"),onkeydown:i,onclick:s}),this.dom=u("div",{class:"cm-panel-lint"},this.list,u("button",{type:"button",name:"close","aria-label":this.view.state.phrase("close"),onclick:()=>he(this.view)},"×")),this.update()}get selectedIndex(){let e=this.view.state.field(g).selected;if(!e)return-1;for(let i=0;i<this.items.length;i++)if(this.items[i].diagnostic==e.diagnostic)return i;return-1}update(){let{diagnostics:e,selected:i}=this.view.state.field(g),s=0,n=!1,r=null;for(e.between(0,this.view.state.doc.length,(l,o,{spec:a})=>{let c=-1,h;for(let d=s;d<this.items.length;d++)if(this.items[d].diagnostic==a.diagnostic){c=d;break}c<0?(h=new ue(this.view,a.diagnostic),this.items.splice(s,0,h),n=!0):(h=this.items[c],c>s&&(this.items.splice(s,c-s),n=!0)),i&&h.diagnostic==i.diagnostic?h.dom.hasAttribute("aria-selected")||(h.dom.setAttribute("aria-selected","true"),r=h):h.dom.hasAttribute("aria-selected")&&h.dom.removeAttribute("aria-selected"),s++});s<this.items.length&&!(this.items.length==1&&this.items[0].diagnostic.from<0);)n=!0,this.items.pop();this.items.length==0&&(this.items.push(new ue(this.view,{from:-1,to:-1,severity:"info",message:this.view.state.phrase("No diagnostics")})),n=!0),r?(this.list.setAttribute("aria-activedescendant",r.id),this.view.requestMeasure({key:this,read:()=>({sel:r.dom.getBoundingClientRect(),panel:this.list.getBoundingClientRect()}),write:({sel:l,panel:o})=>{l.top<o.top?this.list.scrollTop-=o.top-l.top:l.bottom>o.bottom&&(this.list.scrollTop+=l.bottom-o.bottom)}})):this.selectedIndex<0&&this.list.removeAttribute("aria-activedescendant"),n&&this.sync()}sync(){let e=this.list.firstChild;function i(){let s=e;e=s.nextSibling,s.remove()}for(let s of this.items)if(s.dom.parentNode==this.list){for(;e!=s.dom;)i();e=s.dom.nextSibling}else this.list.insertBefore(s.dom,e);for(;e;)i()}moveSelection(e){if(this.selectedIndex<0)return;let i=this.view.state.field(g),s=D(i.diagnostics,this.items[e].diagnostic);s&&this.view.dispatch({selection:{anchor:s.from,head:s.to},scrollIntoView:!0,effects:we.of(s)})}static open(e){return new K(e)}}function Ht(t,e='viewBox="0 0 40 40"'){return`url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" ${e}>${encodeURIComponent(t)}</svg>')`}function V(t){return Ht(`<path d="m0 2.5 l2 -1.5 l1 0 l2 1.5 l1 0" stroke="${t}" fill="none" stroke-width=".7"/>`,'width="6" height="3"')}const Nt=y.baseTheme({".cm-diagnostic":{padding:"3px 6px 3px 8px",marginLeft:"-1px",display:"block",whiteSpace:"pre-wrap"},".cm-diagnostic-error":{borderLeft:"5px solid #d11"},".cm-diagnostic-warning":{borderLeft:"5px solid orange"},".cm-diagnostic-info":{borderLeft:"5px solid #999"},".cm-diagnosticAction":{font:"inherit",border:"none",padding:"2px 4px",backgroundColor:"#444",color:"white",borderRadius:"3px",marginLeft:"8px"},".cm-diagnosticSource":{fontSize:"70%",opacity:.7},".cm-lintRange":{backgroundPosition:"left bottom",backgroundRepeat:"repeat-x",paddingBottom:"0.7px"},".cm-lintRange-error":{backgroundImage:V("#d11")},".cm-lintRange-warning":{backgroundImage:V("orange")},".cm-lintRange-info":{backgroundImage:V("#999")},".cm-lintRange-active":{backgroundColor:"#ffdd9980"},".cm-tooltip-lint":{padding:0,margin:0},".cm-lintPoint":{position:"relative","&:after":{content:'""',position:"absolute",bottom:0,left:"-2px",borderLeft:"3px solid transparent",borderRight:"3px solid transparent",borderBottom:"4px solid #d11"}},".cm-lintPoint-warning":{"&:after":{borderBottomColor:"orange"}},".cm-lintPoint-info":{"&:after":{borderBottomColor:"#999"}},".cm-panel.cm-panel-lint":{position:"relative","& ul":{maxHeight:"100px",overflowY:"auto","& [aria-selected]":{backgroundColor:"#ddd","& u":{textDecoration:"underline"}},"&:focus [aria-selected]":{background_fallback:"#bdf",backgroundColor:"Highlight",color_fallback:"white",color:"HighlightText"},"& u":{textDecoration:"none"},padding:0,margin:0},"& [name=close]":{position:"absolute",top:"0",right:"2px",background:"inherit",border:"none",font:"inherit",padding:0,margin:0}}}),_t=[Ie(),qe(),$e(),Oe(),Be(),Ke(),ze(),fe.allowMultipleSelections.of(!0),He(),Ne(Ve,{fallback:!0}),_e(),Qe(),je(),Ge(),Ue(),Je(),at(),Ye.of([...Ze,...Xe,...At,...et,...tt,...it,...Bt])];export{_t as b};
