import{d as fe,b as f,Z as ve,_ as _e,k as E,e as G,o as _,c as U,U as l,O as t,u as a,D as ge,ai as p,aq as Ve,P as be,S as g,T as P,a as V,F as T,a8 as q,M as W,a9 as ye,i as we,n as Ue,bl as De,bj as he}from"./@vue-CIdpUgdv.js";import Ae from"./AppList-DlR5mOvI.js";import{g as Se,a as ze,u as xe,e as Ie,s as ke}from"./asApplication-cyou5BJm.js";import{u as Be}from"./index-jX4CTekM.js";import{u as Fe}from"./index-CNipAdKq.js";import{M as Re}from"./@element-plus-jSNvwxF2.js";import{Y as Ce,a as Me}from"./index-Cf93PWEY.js";import{a as y,d as j}from"./element-plus-BcbsnzDt.js";import"./lodash-kx6XzW9U.js";import"./@intlify-BrbEMGpa.js";import"./pinia-DE-bJcb2.js";import"./vue-demi-Dq6ymT-8.js";import"./vue-router-CWOL7ATe.js";import"./js-cookie-Cz0CWeBA.js";import"./nprogress-ekFNJb3B.js";import"./axios-CdtiCRuU.js";import"./qs-Cbync0Ql.js";import"./side-channel-Bxu5bNZA.js";import"./get-intrinsic-BKEvijrG.js";import"./es-errors-DzOT6E3C.js";import"./has-symbols-eVqrYdw7.js";import"./has-proto-JnoBQRdH.js";import"./function-bind-BbkWVFrm.js";import"./hasown-DYqjtFKE.js";import"./call-bind-Bt3bzbWQ.js";import"./set-function-length-B5OANX0j.js";import"./define-data-property-DO9o5wXF.js";import"./es-define-property-tzmkNPou.js";import"./gopd-CEkvUycD.js";import"./has-property-descriptors-DphFXkuo.js";import"./object-inspect-C4zVfScY.js";import"./vue-i18n-C6ZazF2L.js";import"./vue-BUaMJYO7.js";import"./vue-clipboard3-B4JKg9Nx.js";import"./clipboard-UlwKUFeW.js";import"./mitt-DJ65BbbF.js";import"./vue-grid-layout-CBs1MJUm.js";import"./vue-simple-uploader-DfJosV98.js";import"./vue-ueditor-wrap-DRzi_KnA.js";import"./lodash-es-1chB_st9.js";import"./@vueuse-Dw_h8qVP.js";import"./@popperjs-D9SI2xQl.js";import"./@ctrl-r5W6hzzQ.js";import"./dayjs-BB1_x23Y.js";import"./async-validator-DKvM95Vc.js";import"./memoize-one-BdPwpGay.js";import"./normalize-wheel-es-B6fDCfyv.js";import"./@floating-ui-DSOXY3Ah.js";const z=v=>(De("data-v-f01da6f3"),v=v(),he(),v),Ke={class:"appsource-asApplication-edit"},Oe=z(()=>V("p",null,"1. 本地上传将存储文件/图标在本地, 需要大量的带宽消耗",-1)),Le=z(()=>V("p",null,"2. 解析文件需要临时下载软件包, 请勿解析超大网盘文件包",-1)),Ne={class:"image-preview"},Ee=z(()=>V("div",{class:"el-form-item__label"},"图片预览",-1)),Ge={class:"mt-4"},Pe={class:"dialog-footer"},Te=fe({name:"ApiV1AppsourceAsApplicationEdit",__name:"edit",props:{typeOptions:{type:Array,default:()=>[]},lockOptions:{type:Array,default:()=>[]},lanzouOptions:{type:Array,default:()=>[]},activeOptions:{type:Array,default:()=>[]}},emits:["asApplicationList"],setup(v,{expose:H,emit:J}){const x=J,I="/",{proxy:k}=we(),B=f(null);f();const w=f(!1),F=f(null),D=f("CN"),h=f(""),i=ve({loading:!1,isShowDialog:!1,appDownloadMessage:"开始下载...",formData:{id:void 0,fileUrl:void 0,name:void 0,bundleId:void 0,version:void 0,size:void 0,type:void 0,description:void 0,iconUrl:void 0,lock:!1,lanzou:void 0,weigh:void 0,active:!1,note:void 0,createdBy:void 0,updatedBy:void 0,createdAt:void 0,updatedAt:void 0},rules:{id:[{required:!0,message:"ID不能为空",trigger:"blur"}],name:[{required:!0,message:"应用名称不能为空",trigger:"blur"}]}}),{loading:Y,isShowDialog:A,formData:n,rules:Z,appDownloadMessage:R}=_e(i),C=f(null),M=Ce(),$=E(()=>M.message),Q=s=>{i.appDownloadMessage=s.msg};G(()=>i.formData.size,s=>{let e=s/1024;if(e<1024)i.formData.showSize=e.toFixed(2)+" KB";else{let r=e/1024;if(r<1024)i.formData.showSize=r.toFixed(2)+" MB";else{let m=r/1024;i.formData.showSize=m.toFixed(2)+" GB"}}}),G($,(s,e)=>{!s||s.type==null||Q(s)},{immediate:!0,deep:!0}),E(()=>M.socketStatus);const X=async()=>{var s;await Ue(),(s=F.value)==null||s.focus()},ee=s=>{ae(),s&&Se(s.id).then(e=>{const r=e.data;r.type=""+r.type,r.lock=!!r.lock,r.lanzou=""+r.lanzou,r.active=!!r.active,i.formData=r}),i.isShowDialog=!0},S=()=>{i.isShowDialog=!1};H({openDialog:ee});const le=()=>{S()},oe=()=>{const s=a(B);s&&s.validate(e=>{e&&(i.loading=!0,!i.formData.id||i.formData.id===0?ze(i.formData).then(()=>{y.success("添加成功"),S(),x("asApplicationList")}).finally(()=>{i.loading=!1}):xe(i.formData).then(()=>{y.success("修改成功"),S(),x("asApplicationList")}).finally(()=>{i.loading=!1}))})},ae=()=>{i.formData={id:void 0,fileUrl:void 0,name:void 0,bundleId:void 0,version:void 0,size:void 0,showSize:"0 KB",type:"0",description:void 0,iconUrl:"https://img0.baidu.com/it/u=104684862,1159259552&fm=253",lock:!1,lanzou:"0",weigh:0,active:!0,note:void 0,createdBy:void 0,updatedBy:void 0,createdAt:void 0,updatedAt:void 0}},te=s=>{if(s.length>0){const e=s[0];i.formData.fileUrl=e.url,i.formData.name=e.name,i.formData.size=e.size;let r=e.size/1024;if(r<1024)i.formData.showSize=r.toFixed(2)+" KB";else{let m=r/1024;if(m<1024)i.formData.showSize=m.toFixed(2)+" MB";else{let d=m/1024;i.formData.showSize=d.toFixed(2)+" GB"}}}},ie=s=>{if(s.length>0){const e=s[0];i.formData.iconUrl=e.url}},ne=s=>{w.value=!1,i.formData.iconUrl=s},se=()=>{const s=j.service({text:R,fullscreen:!0});Ie({fileUrl:i.formData.fileUrl}).then(e=>{const r=e.data;i.formData.iconUrl=r.iconUrl,i.formData.name=r.name,i.formData.bundleId=r.bundleId,i.formData.version=r.version,i.formData.size=r.appSize,R.value="开始下载...",s.close()}).finally(()=>{s.close()})},K=async()=>{const s=D.value,e=h.value;if(!e){y.warning("请输入应用名称");return}const r=j.service({text:"搜索中...",fullscreen:!0});ke({name:e,country:s}).then(m=>{const d=m.data;d.results.length===0?y.warning("未找到相关应用"):C.value.displayResults(d.results)}).catch(()=>{y.error("搜索服务暂时不可用，请稍后重试或尝试使用其他地区"),r.close()}).finally(()=>{i.loading=!1,r.close()})};return(s,e)=>{const r=p("el-alert"),m=p("el-image"),d=p("el-form-item"),re=p("el-space"),b=p("el-button"),c=p("el-input"),u=p("el-option"),O=p("el-select"),L=p("el-switch"),de=p("el-radio"),pe=p("el-radio-group"),ue=p("el-input-number"),me=p("el-form"),N=p("el-dialog"),ce=Ve("drag");return _(),U("div",Ke,[l(N,{modelValue:a(A),"onUpdate:modelValue":e[17]||(e[17]=o=>ge(A)?A.value=o:null),width:"800px","close-on-click-modal":!1,"destroy-on-close":!0},{header:t(()=>[be((_(),U("div",null,[g(P((!a(n).id||a(n).id==0?"添加":"修改")+"应用管理"),1)])),[[ce,[".appsource-asApplication-edit .el-dialog",".appsource-asApplication-edit .el-dialog__header"]]])]),footer:t(()=>[V("div",Pe,[l(b,{type:"primary",onClick:oe,disabled:a(Y)},{default:t(()=>[g("确 定")]),_:1},8,["disabled"]),l(b,{onClick:le},{default:t(()=>[g("取 消")]),_:1})])]),default:t(()=>[l(me,{ref_key:"formRef",ref:B,model:a(n),rules:a(Z),"label-width":"120px"},{default:t(()=>[l(re,{fill:""},{default:t(()=>[l(r,{type:"info","show-icon":"",closable:!1},{default:t(()=>[Oe,Le]),_:1}),l(d,{label:"本地上传包"},{default:t(()=>[l(Be,{action:a(I)+"api/v1/system/upload/singleFile",limit:1,"onUpdate:modelValue":te},null,8,["action"]),V("div",Ne,[Ee,l(m,{style:{"max-width":"150px","max-height":"150px"},src:a(k).getUpFileUrl(a(n).iconUrl),"zoom-rate":1.2,"max-scale":7,"min-scale":.2,"preview-src-list":[a(k).getUpFileUrl(a(n).iconUrl)],"initial-index":0,"preview-teleported":"","hide-on-click-modal":""},null,8,["src","preview-src-list"])])]),_:1})]),_:1}),l(d,{label:"软件地址",prop:"fileUrl"},{default:t(()=>[l(c,{modelValue:a(n).fileUrl,"onUpdate:modelValue":e[0]||(e[0]=o=>a(n).fileUrl=o),placeholder:"请输入软件地址或上传"},{append:t(()=>[l(b,{onClick:se},{default:t(()=>[g("解析文件")]),_:1})]),_:1},8,["modelValue"])]),_:1}),l(d,{label:"应用名称",prop:"name"},{default:t(()=>[l(c,{modelValue:a(n).name,"onUpdate:modelValue":e[1]||(e[1]=o=>a(n).name=o),placeholder:"请输入应用名称"},null,8,["modelValue"])]),_:1}),l(d,{label:"图标",prop:"iconUrl"},{default:t(()=>[l(c,{modelValue:a(n).iconUrl,"onUpdate:modelValue":e[3]||(e[3]=o=>a(n).iconUrl=o),placeholder:"请输入图标"},{append:t(()=>[l(Fe,{class:"app-image-upload",action:a(I)+"api/v1/system/upload/singleImg","onUpdate:modelValue":ie,limit:1},null,8,["action"])]),prepend:t(()=>[l(b,{onClick:e[2]||(e[2]=o=>w.value=!0)},{default:t(()=>[g("搜索")]),_:1})]),_:1},8,["modelValue"])]),_:1}),l(d,{label:"包名",prop:"bundleId"},{default:t(()=>[l(c,{modelValue:a(n).bundleId,"onUpdate:modelValue":e[4]||(e[4]=o=>a(n).bundleId=o),placeholder:"请输入包名"},null,8,["modelValue"])]),_:1}),l(d,{label:"版本号",prop:"version"},{default:t(()=>[l(c,{modelValue:a(n).version,"onUpdate:modelValue":e[5]||(e[5]=o=>a(n).version=o),placeholder:"请输入版本号"},null,8,["modelValue"])]),_:1}),l(d,{label:"文件大小",prop:"size"},{default:t(()=>[l(c,{modelValue:a(n).showSize,"onUpdate:modelValue":e[6]||(e[6]=o=>a(n).showSize=o),placeholder:"请输入文件大小"},null,8,["modelValue"])]),_:1}),l(d,{label:"类型",prop:"type"},{default:t(()=>[l(O,{filterable:"",clearable:"",modelValue:a(n).type,"onUpdate:modelValue":e[7]||(e[7]=o=>a(n).type=o),placeholder:"请选择类型"},{default:t(()=>[(_(!0),U(T,null,q(v.typeOptions,o=>(_(),W(u,{key:o.value,label:o.label,value:o.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(d,{label:"描述",prop:"description"},{default:t(()=>[l(c,{type:"textarea",autosize:{minRows:4,maxRows:10},modelValue:a(n).description,"onUpdate:modelValue":e[8]||(e[8]=o=>a(n).description=o),placeholder:"请输入描述"},null,8,["modelValue"])]),_:1}),l(d,{label:"付费",prop:"lock"},{default:t(()=>[l(L,{modelValue:a(n).lock,"onUpdate:modelValue":e[9]||(e[9]=o=>a(n).lock=o),class:"ml-2"},null,8,["modelValue"])]),_:1}),l(d,{label:"是否蓝奏云链接",prop:"lanzou"},{default:t(()=>[l(pe,{modelValue:a(n).lanzou,"onUpdate:modelValue":e[10]||(e[10]=o=>a(n).lanzou=o)},{default:t(()=>[(_(!0),U(T,null,q(v.lanzouOptions,o=>(_(),W(de,{key:o.value,value:o.value},{default:t(()=>[g(P(o.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(d,{label:"权重",prop:"weigh"},{default:t(()=>[l(ue,{modelValue:a(n).weigh,"onUpdate:modelValue":e[11]||(e[11]=o=>a(n).weigh=o),placeholder:"请输入权重"},null,8,["modelValue"])]),_:1}),l(d,{label:"是否启用",prop:"active"},{default:t(()=>[l(L,{modelValue:a(n).active,"onUpdate:modelValue":e[12]||(e[12]=o=>a(n).active=o),class:"ml-2"},null,8,["modelValue"])]),_:1}),l(d,{label:"备注",prop:"note"},{default:t(()=>[l(c,{modelValue:a(n).note,"onUpdate:modelValue":e[13]||(e[13]=o=>a(n).note=o),type:"textarea",placeholder:"请输入备注"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"]),l(N,{modelValue:w.value,"onUpdate:modelValue":e[16]||(e[16]=o=>w.value=o),width:"600",title:"AppStore图标搜索","append-to-body":"","close-on-click-modal":!1,"destroy-on-close":!0,onOpened:X},{default:t(()=>[V("div",Ge,[l(c,{ref_key:"appSearchInputRef",ref:F,modelValue:h.value,"onUpdate:modelValue":e[15]||(e[15]=o=>h.value=o),style:{"max-width":"600px"},placeholder:"输入应用名称",class:"input-with-select",onKeyup:ye(K,["enter"])},{append:t(()=>[l(b,{icon:a(Re),onClick:K},null,8,["icon"])]),prepend:t(()=>[l(O,{modelValue:D.value,"onUpdate:modelValue":e[14]||(e[14]=o=>D.value=o),placeholder:"选择地区",style:{width:"115px"}},{default:t(()=>[l(u,{value:"CN",label:"中国"}),l(u,{value:"US",label:"美国"}),l(u,{value:"JP",label:"日本"}),l(u,{value:"KR",label:"韩国"}),l(u,{value:"HK",label:"香港"}),l(u,{value:"TW",label:"台湾"}),l(u,{value:"GB",label:"英国"}),l(u,{value:"DE",label:"德国"}),l(u,{value:"FR",label:"法国"})]),_:1},8,["modelValue"])]),_:1},8,["modelValue"]),l(Ae,{ref_key:"appListRef",ref:C,onIconSelected:ne},null,512)])]),_:1},8,["modelValue"])]),_:1},8,["modelValue"])])}}}),Ll=Me(Te,[["__scopeId","data-v-f01da6f3"]]);export{Ll as default};
