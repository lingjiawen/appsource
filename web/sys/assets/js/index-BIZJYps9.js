import{j as H}from"./jsplumb-BNzSJ0MZ.js";import{S as de}from"./sortablejs-C0-Qcoum.js";import{s as F}from"./pinia-DE-bJcb2.js";import{i as pe,u as ue,j as me,a as fe}from"./index-Cf93PWEY.js";import be from"./index-C3OauVMy.js";import he from"./help-CBUrUKcz.js";import we from"./index-8UFgRmq4.js";import ge from"./index-BOImTpsR.js";import{a as C,E as ke}from"./element-plus-BcbsnzDt.js";import{d as je,b as L,Z as Ce,k as ye,j as Ie,Y as xe,_ as Le,n as D,o as f,c as b,R as De,a as c,U as u,O as Te,F as M,a8 as O,J as z,ai as k,T as q,I as V,a2 as _e}from"./@vue-CIdpUgdv.js";import"./@intlify-BrbEMGpa.js";import"./vue-demi-Dq6ymT-8.js";import"./vue-router-CWOL7ATe.js";import"./js-cookie-Cz0CWeBA.js";import"./@element-plus-jSNvwxF2.js";import"./nprogress-ekFNJb3B.js";import"./axios-CdtiCRuU.js";import"./qs-Cbync0Ql.js";import"./side-channel-Bxu5bNZA.js";import"./get-intrinsic-BKEvijrG.js";import"./es-errors-DzOT6E3C.js";import"./has-symbols-eVqrYdw7.js";import"./has-proto-JnoBQRdH.js";import"./function-bind-BbkWVFrm.js";import"./hasown-DYqjtFKE.js";import"./call-bind-Bt3bzbWQ.js";import"./set-function-length-B5OANX0j.js";import"./define-data-property-DO9o5wXF.js";import"./es-define-property-tzmkNPou.js";import"./gopd-CEkvUycD.js";import"./has-property-descriptors-DphFXkuo.js";import"./object-inspect-C4zVfScY.js";import"./vue-i18n-C6ZazF2L.js";import"./vue-BUaMJYO7.js";import"./vue-clipboard3-B4JKg9Nx.js";import"./clipboard-UlwKUFeW.js";import"./mitt-DJ65BbbF.js";import"./vue-grid-layout-CBs1MJUm.js";import"./vue-simple-uploader-DfJosV98.js";import"./vue-ueditor-wrap-DRzi_KnA.js";import"./lodash-es-1chB_st9.js";import"./@vueuse-Dw_h8qVP.js";import"./@popperjs-D9SI2xQl.js";import"./@ctrl-r5W6hzzQ.js";import"./dayjs-BB1_x23Y.js";import"./async-validator-DKvM95Vc.js";import"./memoize-one-BdPwpGay.js";import"./normalize-wheel-es-B6fDCfyv.js";import"./@floating-ui-DSOXY3Ah.js";import"./line-VH_YwMW5.js";import"./node-KxEeqOjv.js";import"./echarts-CwA8CIbg.js";import"./zrender-JgsgmSHm.js";import"./tslib-BDyQ-Jie.js";const Pe=[{title:"工作流",icon:"iconfont icon-shouye",isOpen:!0,id:"1",children:[{icon:"iconfont icon-gongju",name:"引擎",id:"11",form:[{type:"input",label:"客户姓名",prop:"name",placeholder:"请输入客户姓名",required:!0,disabled:!1},{type:"select",label:"性别",prop:"sex",placeholder:"请选择性别",required:!0,disabled:!1,options:[{value:"0",label:"女"},{value:"1",label:"男"}]},{type:"input",label:"员工编号",prop:"number",placeholder:"请输入员工编号",required:!0,disabled:!1},{type:"input",label:"办公电话",prop:"mobile",placeholder:"请输入办公电话",required:!0,disabled:!1},{type:"select",label:"权限分配",prop:"role",placeholder:"请选择性别",required:!0,disabled:!1,options:[{value:"0",label:"编辑权限"},{value:"1",label:"删除权限"}]},{type:"checkbox",label:"模块选择",prop:"module",placeholder:"请选择模块",required:!0,disabled:!1}]},{icon:"iconfont icon-shouye_dongtaihui",name:"模版",id:"12",form:[{type:"input",label:"等级",prop:"grade",placeholder:"请输入等级",required:!0,disabled:!1},{type:"input",label:"登记密码",prop:"password",placeholder:"请输入登记密码",required:!0,disabled:!1}]},{icon:"iconfont icon-zhongduancanshuchaxun",name:"名称",id:"13",form:[{type:"input",label:"数据表",prop:"dataSheet",placeholder:"请输入数据表",required:!0,disabled:!1},{type:"input",label:"字段配置",prop:"field",placeholder:"请输入字段配置",required:!0,disabled:!1}]},{icon:"iconfont icon-zhongduancanshu",name:"版本",id:"14",form:[{type:"input",label:"发布模板",prop:"publish",placeholder:"请输入发布模板",required:!0,disabled:!1}]},{icon:"iconfont icon-bolangnengshiyanchang",name:"建模",id:"15",form:[{type:"input",label:"内容模板",prop:"content",placeholder:"请输入内容模板",required:!0,disabled:!1}]},{icon:"iconfont icon-xingqiu",name:"节点",id:"16",form:[{type:"input",label:"活动名称6",prop:"name16"}]}]},{title:"流程",isOpen:!0,icon:"iconfont icon-caijian",id:"2",children:[{icon:"iconfont icon-fuwenben",name:"实例",id:"21",form:[{type:"input",label:"活动名称7",prop:"name21"}]},{icon:"iconfont icon-fuwenbenkuang",name:"轨迹",id:"22",form:[{type:"input",label:"活动名称8",prop:"name22"}]},{icon:"iconfont icon-shangchuan",name:"数据",id:"23",form:[{type:"input",label:"活动名称9",prop:"name23"}]}]},{title:"任务",isOpen:!0,icon:"iconfont icon-shuju",id:"3",children:[{icon:"iconfont icon-icon-",name:"参与人",id:"31",form:[{type:"input",label:"活动名称1",prop:"name31"}]},{icon:"iconfont icon-gerenzhongxin",name:"执行人",id:"32",form:[{type:"input",label:"活动名称2",prop:"name32"}]},{icon:"iconfont icon-fangkuang",name:"工单",id:"33",form:[{type:"input",label:"活动名称3",prop:"name33"}]}]}],Ne={Anchors:["Top","TopCenter","TopRight","TopLeft","Right","RightMiddle","Bottom","BottomCenter","BottomRight","BottomLeft","Left","LeftMiddle"],Container:"workflow-right",Connector:["Bezier",{curviness:100}],ConnectionsDetachable:!1,DeleteEndpointsOnDetach:!1,Endpoint:["Blank",{Overlays:""}],EndpointStyle:{fill:"#1879ffa1",outlineWidth:1},LogEnabled:!0,PaintStyle:{stroke:"#E0E3E7",strokeWidth:1,outlineStroke:"transparent",outlineWidth:10},DragOptions:{cursor:"pointer",zIndex:2e3},Overlays:[["Arrow",{width:10,length:8,location:1,direction:1,foldback:.623}],["Label",{label:"",location:.5,cssClass:"aLabel"}]],RenderMode:"svg",HoverPaintStyle:{stroke:"#b0b2b5",strokeWidth:1},EndpointHoverStyle:{fill:"red"},Scope:"jsPlumb_DefaultScope"},Se={filter:".workflow-icon-drag",filterExclude:!1,anchor:"Continuous",allowLoopback:!0,maxConnections:-1},Ee={filter:".workflow-icon-drag",filterExclude:!1,anchor:"Continuous",allowLoopback:!0,dropOptions:{hoverClass:"ef-drop-hover"}},B={isSource:!0,isTarget:!0,anchor:"Continuous"},ve=je({name:"pagesWorkflow",components:{Tool:be,Contextmenu:we,Drawer:ge,Help:he},setup(){const s=L(),T=L(),y=L(),_=L(),P=pe(),W=ue(),{themeConfig:I}=F(W),{isTagsViewCurrenFull:j}=F(P),{copyText:N}=me(),e=Ce({workflowRightRef:null,leftNavRefs:[],leftNavList:[],dropdownNode:{x:"",y:""},dropdownLine:{x:"",y:""},isShow:!1,jsPlumb:null,jsPlumbNodeIndex:null,jsplumbDefaults:Ne,jsplumbMakeSource:Se,jsplumbMakeTarget:Ee,jsplumbConnect:B,jsplumbData:{nodeList:[],lineList:[]}}),S=ye(()=>{let{isTagsview:o}=I.value;return j.value?"30px":o?"114px":"80px"}),h=()=>{document.body.clientWidth<768?e.isShow=!0:e.isShow=!1},r=()=>{e.leftNavList=Pe,e.jsplumbData={nodeList:[{nodeId:"huej738hbji",left:"148px",top:"93px",class:"workflow-right-clone",icon:"iconfont icon-gongju",name:"引擎",id:"11"},{nodeId:"52kcszzyxrd",left:"458px",top:"203px",class:"workflow-right-clone",icon:"iconfont icon-shouye_dongtaihui",name:"模版",id:"12"},{nodeId:"nltskl6k4me",left:"164px",top:"350px",class:"workflow-right-clone",icon:"iconfont icon-zhongduancanshuchaxun",name:"名称",id:"13"}],lineList:[{sourceId:"huej738hbji",targetId:"52kcszzyxrd",label:"传送"},{sourceId:"huej738hbji",targetId:"nltskl6k4me",label:""}]}},w=()=>{e.leftNavRefs.forEach(o=>{de.create(o,{group:{name:"vue-next-admin-1",pull:"clone",put:!1},animation:0,sort:!1,draggable:".workflow-left-item",forceFallback:!0,onEnd:function(n){const{name:t,icon:l,id:i}=n.clone.dataset,{layerX:a,layerY:p,clientX:m,clientY:g}=n.originalEvent,se=e.workflowRightRef,{x:A,y:v,width:re,height:ae}=se.getBoundingClientRect();if(m<A||m>re+A||g<v||v>v+ae)C.warning("请把节点拖入到画布中");else{const x=Math.random().toString(36).substr(2,12),ce={nodeId:x,left:`${a-40}px`,top:`${p-15}px`,class:"workflow-right-clone",name:t,icon:l,id:i};e.jsplumbData.nodeList.push(ce),D(()=>{e.jsPlumb.makeSource(x,e.jsplumbMakeSource),e.jsPlumb.makeTarget(x,e.jsplumbMakeTarget,B),e.jsPlumb.draggable(x,{containment:"parent",stop:R=>{e.jsplumbData.nodeList.forEach($=>{$.nodeId===R.el.id&&($.left=`${R.pos[0]}px`,$.top=`${R.pos[1]}px`)})}})})}}})})},d=()=>{H.jsPlumb.ready(()=>{e.jsPlumb=H.jsPlumb.getInstance({detachable:!1,Container:"workflow-right"}),e.jsPlumb.fire("jsPlumbDemoLoaded",e.jsPlumb),e.jsPlumb.importDefaults(e.jsplumbDefaults),e.jsPlumb.setSuspendDrawing(!1,!0),E(),e.jsPlumb.bind("contextmenu",(o,n)=>{n.preventDefault();const{sourceId:t,targetId:l}=o,{clientX:i,clientY:a}=n;e.dropdownLine.x=i,e.dropdownLine.y=a;const p=e.jsplumbData.nodeList.find(g=>g.nodeId===l),m=e.jsplumbData.lineList.find(g=>g.sourceId===t&&g.targetId===l);p.type="line",p.label=m.label,T.value.openContextmenu(p,o)}),e.jsPlumb.bind("beforeDrop",o=>{const{sourceId:n,targetId:t}=o;return e.jsplumbData.lineList.find(i=>i.sourceId===n&&i.targetId===t)?(C.warning("关系已存在，不可重复连接"),!1):!0}),e.jsPlumb.bind("connection",o=>{const{sourceId:n,targetId:t}=o;e.jsplumbData.lineList.push({sourceId:n,targetId:t,label:""})}),e.jsPlumb.bind("connectionDetached",o=>{const{sourceId:n,targetId:t}=o;e.jsplumbData.lineList=e.jsplumbData.lineList.filter(l=>!(l.sourceId==n&&l.targetId==t))})})},E=()=>{e.jsplumbData.nodeList.forEach(o=>{e.jsPlumb.makeSource(o.nodeId,e.jsplumbMakeSource),e.jsPlumb.makeTarget(o.nodeId,e.jsplumbMakeTarget,B),e.jsPlumb.draggable(o.nodeId,{containment:"parent",stop:n=>{e.jsplumbData.nodeList.forEach(t=>{t.nodeId===n.el.id&&(t.left=`${n.pos[0]}px`,t.top=`${n.pos[1]}px`)})}})}),e.jsplumbData.lineList.forEach(o=>{e.jsPlumb.connect({source:o.sourceId,target:o.targetId,label:o.label},e.jsplumbConnect)})},J=o=>{o.isOpen=!o.isOpen},Y=o=>{e.jsPlumbNodeIndex=o},X=(o,n,t)=>{e.jsPlumbNodeIndex=n;const{clientX:l,clientY:i}=t;e.dropdownNode.x=l,e.dropdownNode.y=i,o.type="node",o.label="";let a={};e.leftNavList.forEach(p=>{p.children&&p.children.find(m=>m.id===o.id)&&(a=p.children.find(m=>m.id===o.id))}),o.from=a.form,s.value.openContextmenu(o)},U=o=>{const{contextMenuClickId:n,nodeId:t}=o;if(n===0){const l=e.jsplumbData.nodeList.findIndex(i=>i.nodeId===t);e.jsplumbData.nodeList.splice(l,1),e.jsPlumb.removeAllEndpoints(t),e.jsPlumbNodeIndex=null}else n===1&&y.value.open(o)},Z=(o,n)=>{const{contextMenuClickId:t}=o,{endpoints:l}=n,i=[];l.forEach(a=>{i.push({id:a.element.id,innerText:a.element.innerText})}),o.contact=`${i[0].innerText}(${i[0].id}) => ${i[1].innerText}(${i[1].id})`,t===0?e.jsPlumb.deleteConnection(n):t===1&&y.value.open(o,n)},G=o=>{const{sourceId:n,targetId:t,label:l}=o,i=e.jsPlumb.getConnections({source:n,target:t})[0];i.setLabel(l),!l||l===""?i.addClass("workflow-right-empty-label"):(i.removeClass("workflow-right-empty-label"),i.addClass("workflow-right-label")),e.jsplumbData.lineList.forEach(a=>{a.sourceId===n&&a.targetId===t&&(a.label=l)})},K=o=>{const{nodeId:n,name:t,icon:l}=o;e.jsplumbData.nodeList.forEach(i=>{i.nodeId===n&&(i.name=t,i.icon=l)}),D(()=>{e.jsPlumb.setSuspendDrawing(!1,!0)})},Q=o=>{switch(o){case"help":ee();break;case"download":oe();break;case"submit":ne();break;case"copy":te();break;case"del":ie();break;case"fullscreen":le();break}},ee=()=>{D(()=>{_.value.open()})},oe=()=>{const{globalTitle:o}=I.value,n="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(e.jsplumbData,null,"	")),t=document.createElement("a");t.setAttribute("href",n),t.setAttribute("download",`${o}工作流.json`),t.click(),t.remove(),C.success("下载成功")},ne=()=>{C.success("数据提交成功")},te=()=>{N(JSON.stringify(e.jsplumbData))},ie=()=>{ke.confirm("此操作将清空画布，是否继续？","提示",{confirmButtonText:"清空",cancelButtonText:"取消"}).then(()=>{e.jsplumbData.nodeList.forEach(o=>{e.jsPlumb.removeAllEndpoints(o.nodeId)}),D(()=>{e.jsplumbData={nodeList:[],lineList:[]},C.success("清空画布成功")})}).catch(()=>{})},le=()=>{P.setCurrenFullscreen(!0)};return Ie(async()=>{await r(),w(),d(),h(),window.addEventListener("resize",h)}),xe(()=>{window.removeEventListener("resize",h)}),{setViewHeight:S,setClientWidth:h,setLineLabel:G,setNodeContent:K,onTitleClick:J,onItemCloneClick:Y,onContextmenu:X,onCurrentNodeClick:U,onCurrentLineClick:Z,contextmenuNodeRef:s,contextmenuLineRef:T,drawerRef:y,helpRef:_,onToolClick:Q,...Le(e)}}}),Re={class:"workflow-container"},$e={key:0,class:"workflow-mask"},Me={class:"workflow"},Oe={class:"workflow-content"},ze={class:"workflow-left"},qe=["onClick"],Be=["data-name","data-icon","data-id"],We={class:"workflow-left-item-icon"},Ae={class:"font10 pl5 name"},He={class:"workflow-right",ref:"workflowRightRef"},Fe=["id","data-node-id","onClick","onContextmenu"],Ve={class:"workflow-left-item-icon"},Je={class:"font10 pl5 name"};function Ye(s,T,y,_,P,W){const I=k("Tool"),j=k("SvgIcon"),N=k("el-scrollbar"),e=k("Contextmenu"),S=k("Drawer"),h=k("Help");return f(),b("div",Re,[s.isShow?(f(),b("div",$e)):De("",!0),c("div",{class:"layout-view-bg-white flex",style:z({height:`calc(100vh - ${s.setViewHeight}`})},[c("div",Me,[u(I,{onTool:s.onToolClick},null,8,["onTool"]),c("div",Oe,[c("div",ze,[u(N,null,{default:Te(()=>[(f(!0),b(M,null,O(s.leftNavList,(r,w)=>(f(),b("div",{ref_for:!0,ref:"leftNavRefs",key:r.id,style:z({height:r.isOpen?"auto":"50px",overflow:"hidden"}),class:"workflow-left-id"},[c("div",{class:"workflow-left-title",onClick:d=>s.onTitleClick(r)},[c("span",null,q(r.title),1),u(j,{name:r.isOpen?"ele-ArrowDown":"ele-ArrowRight"},null,8,["name"])],8,qe),(f(!0),b(M,null,O(r.children,(d,E)=>(f(),b("div",{class:"workflow-left-item",key:E,"data-name":d.name,"data-icon":d.icon,"data-id":d.id},[c("div",We,[u(j,{name:d.icon,class:"workflow-icon-drag"},null,8,["name"]),c("div",Ae,q(d.name),1)])],8,Be))),128))],4))),128))]),_:1})]),c("div",He,[(f(!0),b(M,null,O(s.jsplumbData.nodeList,(r,w)=>(f(),b("div",{key:r.nodeId,id:r.nodeId,"data-node-id":r.nodeId,class:V(r.class),style:z({left:r.left,top:r.top}),onClick:d=>s.onItemCloneClick(w),onContextmenu:_e(d=>s.onContextmenu(r,w,d),["prevent"])},[c("div",{class:V(["workflow-right-box",{"workflow-right-active":s.jsPlumbNodeIndex===w}])},[c("div",Ve,[u(j,{name:r.icon,class:"workflow-icon-drag"},null,8,["name"]),c("div",Je,q(r.name),1)])],2)],46,Fe))),128))],512)])])],4),u(e,{dropdown:s.dropdownNode,ref:"contextmenuNodeRef",onCurrent:s.onCurrentNodeClick},null,8,["dropdown","onCurrent"]),u(e,{dropdown:s.dropdownLine,ref:"contextmenuLineRef",onCurrent:s.onCurrentLineClick},null,8,["dropdown","onCurrent"]),u(S,{ref:"drawerRef",onLabel:s.setLineLabel,onNode:s.setNodeContent},null,8,["onLabel","onNode"]),u(h,{ref:"helpRef"},null,512)])}const Uo=fe(ve,[["render",Ye],["__scopeId","data-v-1215c5be"]]);export{Uo as default};
