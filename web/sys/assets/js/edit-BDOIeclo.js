import{u as se}from"./index-CNipAdKq.js";import{u as ie}from"./index-jX4CTekM.js";import{S as ne}from"./spark-md5-C5cDV8iz.js";import{g as re,a as ue}from"./index-Cf93PWEY.js";import{_ as de}from"./lodash-kx6XzW9U.js";import{c as pe,u as ce}from"./sysAttachment-Ck2tH_YR.js";import{a as me}from"./axios-CdtiCRuU.js";import{a as X,E as fe}from"./element-plus-BcbsnzDt.js";import{d as Y,b as h,k as ge,ai as w,o as m,M as L,O as y,c as V,U as _,R as b,F as j,a as U,T as H,S as J,i as ve,Z as _e,_ as he,e as ye,u as F,D as E,aq as ke,P as xe}from"./@vue-CIdpUgdv.js";import"./@intlify-BrbEMGpa.js";import"./pinia-DE-bJcb2.js";import"./vue-demi-Dq6ymT-8.js";import"./vue-router-CWOL7ATe.js";import"./js-cookie-Cz0CWeBA.js";import"./@element-plus-jSNvwxF2.js";import"./nprogress-ekFNJb3B.js";import"./qs-Cbync0Ql.js";import"./side-channel-Bxu5bNZA.js";import"./get-intrinsic-BKEvijrG.js";import"./es-errors-DzOT6E3C.js";import"./has-symbols-eVqrYdw7.js";import"./has-proto-JnoBQRdH.js";import"./function-bind-BbkWVFrm.js";import"./hasown-DYqjtFKE.js";import"./call-bind-Bt3bzbWQ.js";import"./set-function-length-B5OANX0j.js";import"./define-data-property-DO9o5wXF.js";import"./es-define-property-tzmkNPou.js";import"./gopd-CEkvUycD.js";import"./has-property-descriptors-DphFXkuo.js";import"./object-inspect-C4zVfScY.js";import"./vue-i18n-C6ZazF2L.js";import"./vue-BUaMJYO7.js";import"./vue-clipboard3-B4JKg9Nx.js";import"./clipboard-UlwKUFeW.js";import"./mitt-DJ65BbbF.js";import"./vue-grid-layout-CBs1MJUm.js";import"./vue-simple-uploader-DfJosV98.js";import"./vue-ueditor-wrap-DRzi_KnA.js";import"./lodash-es-1chB_st9.js";import"./@vueuse-Dw_h8qVP.js";import"./@popperjs-D9SI2xQl.js";import"./@ctrl-r5W6hzzQ.js";import"./dayjs-BB1_x23Y.js";import"./async-validator-DKvM95Vc.js";import"./memoize-one-BdPwpGay.js";import"./normalize-wheel-es-B6fDCfyv.js";import"./@floating-ui-DSOXY3Ah.js";const we=U("div",{class:"el-upload__text"},[J(" 拖拽文件至此 或"),U("em",null,"点击上传")],-1),Se={class:"el-upload__text"},Be={class:"el-upload__text"},Fe={key:0,class:"progress-show"},Ve=U("div",{class:"el-upload__tip"}," 大文件上传：支持分片上传，断点续传及秒传功能 ",-1),Ue=Y({name:"uploadBigFile",__name:"index",props:{name:{type:String,default:"file"},method:{type:String,default:"post"},multiple:{type:Boolean,default:!0},showFileList:{type:Boolean,default:!0},drag:{type:Boolean,default:!0},disabled:{type:Boolean,default:!1},listType:{type:String,default:"picture-card"},limit:{type:Number,default:5},modelValue:{type:Array,default:function(){return[]}}},emits:["update:modelValue"],setup(R,{expose:N,emit:P}){const C=R,$=P,f=h(),l=h(0),S=h(""),x=h(0),i=h("0byte");let n=[];const{proxy:D}=ve(),u=ge({get:()=>{let e=C.modelValue||[];return e.map(t=>(t.url&&(t.url=D.getUpFileUrl(t.url)),t)),n=de.cloneDeep(e),e},set:e=>{$("update:modelValue",e)}}),q=e=>{},z=me.CancelToken.source(),O=async e=>{const{name:t,size:o,raw:r}=e;i.value=te(o);try{l.value=1;const a=await ee(r);l.value=2;let B=1;const s=1024*1024*2,p=Array.from({length:Math.ceil(o/s)},(v,Z)=>Z+1),k=await pe({fileName:t,size:o,md5:a,shardsCount:p.length});if(!k.data.waitUploadIndex||k.data.waitUploadIndex.length==0){M(k.data.attachment,e);return}const c=p.filter(v=>k.data.waitUploadIndex.includes(v));if(c.length==0){M(k.data.attachment,e);return}let T=(p.length-c.length-1)*s;for(const v of c){if(l.value==3)break;let Z=(v-1)*s,oe=v*s;T+=s;const ae=le=>{x.value=Math.round((T+le.loaded)/o*100)},W=await ce({fileName:t,size:o,md5:a,shardsCount:p.length,index:v,file:r.slice(Z,oe),token:re()},ae,z);B=v,W.data.data.finish&&M(W.data.data.attachment,e)}}catch(a){a.code==="ERR_CANCELED"?X.error("已关闭上传，下次上传将继续从断点处上传"):console.log("error:",a),Q()}},M=(e,t)=>{n=n.filter(o=>{var r,a;return((r=o.raw)==null?void 0:r.uid)!=((a=t.raw)==null?void 0:a.uid)}),n.push({name:e.name,url:e.path,fullUrl:e.fullPath,fileType:e.type,size:e.size}),I(),Q()},A=()=>{X.error("最多可上传"+C.limit+"个文件,已超出最大限制数。")},d=e=>fe.confirm(`您确定要删除 ${e.name} ?`,"提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(()=>!0,()=>!1),G=e=>{n.splice(n.findIndex(t=>t.name===e.name),1),I()},I=()=>{u.value=n},K=e=>{window.open(e.url)},g=()=>{l.value=3,z.cancel()},ee=e=>new Promise((t,o)=>{const a=Math.ceil(e.size/1048576),B=new ne.ArrayBuffer;let s=0;const p=new FileReader;p.onload=c=>{B.append(c.target.result),s++,s<a?(S.value="校验MD5 "+(s/a*100).toFixed(0)+"%",k()):t(B.end())},p.onerror=c=>{o(c)};function k(){const c=s*1048576,T=Math.min(c+1048576,e.size),v=e.slice(c,T);p.readAsArrayBuffer(v)}k()}),te=e=>{if(e===0)return"0 Bytes";const t=["Bytes","KB","MB","GB","TB"],o=Math.floor(Math.log(e)/Math.log(1024));return`${(e/Math.pow(1024,o)).toFixed(2)} ${t[o]}`},Q=()=>{l.value=0,S.value="",x.value=0,i.value="0byte"};return N({stopUpBigFile:g}),(e,t)=>{const o=w("ele-UploadFilled"),r=w("el-icon"),a=w("ele-Loading"),B=w("el-progress"),s=w("el-upload");return m(),L(s,{ref_key:"upBigFileRef",ref:f,"file-list":u.value,"onUpdate:fileList":t[0]||(t[0]=p=>u.value=p),class:"upload-demo",multiple:R.multiple,drag:R.drag,"on-remove":G,"before-remove":d,limit:R.limit,"on-exceed":A,"on-change":O,"on-preview":K,"http-request":q,disabled:l.value!==0},{tip:y(()=>[l.value===2?(m(),V("div",Fe,[_(B,{percentage:x.value},null,8,["percentage"])])):b("",!0),Ve]),default:y(()=>[l.value===0?(m(),V(j,{key:0},[_(r,{class:"el-icon--upload"},{default:y(()=>[_(o)]),_:1}),we],64)):b("",!0),l.value===1?(m(),V(j,{key:1},[_(r,{class:"el-icon--upload"},{default:y(()=>[_(a)]),_:1}),U("div",Se," 文件解析中..."+H(S.value),1)],64)):b("",!0),l.value===2?(m(),V(j,{key:2},[_(r,{class:"el-icon--upload"},{default:y(()=>[_(a)]),_:1}),U("div",Be," 文件上传中...（"+H(x.value)+"%）文件大小："+H(i.value),1)],64)):b("",!0)]),_:1},8,["file-list","multiple","drag","limit","disabled"])}}}),Re={class:"system-sysAttachment-edit"},Ce={class:"dialog-footer"},De=Y({name:"ApiV1SystemSysAttachmentEdit",__name:"edit",emits:["sysAttachmentList"],setup(R,{expose:N,emit:P}){const C="/",$=P,f=h(""),l=h(),S=h(),x=h(),i=_e({isShowDialog:!1,images:[],files:[]}),{isShowDialog:n,images:D,files:u}=he(i),q=A=>{M(),f.value=A,i.isShowDialog=!0},z=()=>{i.isShowDialog=!1,f.value=="image"?S.value.stopUpImage():f.value=="file"?l.value.stopUpFile():f.value=="bigFile"&&x.value.stopUpBigFile()};N({openDialog:q});const O=()=>{z()};ye(()=>[i.images,i.files],()=>{$("sysAttachmentList")});const M=()=>{i.images=[],i.files=[]};return(A,d)=>{const G=w("el-button"),I=w("el-dialog"),K=ke("drag");return m(),V("div",Re,[_(I,{modelValue:F(n),"onUpdate:modelValue":d[3]||(d[3]=g=>E(n)?n.value=g:null),width:"800px","close-on-click-modal":!1,"destroy-on-close":!0},{header:y(()=>[xe((m(),V("div",null,[J("上传")])),[[K,[".system-sysAttachment-edit .el-dialog",".system-sysAttachment-edit .el-dialog__header"]]])]),footer:y(()=>[U("div",Ce,[_(G,{type:"danger",onClick:O},{default:y(()=>[J("关 闭")]),_:1})])]),default:y(()=>[f.value==="image"?(m(),L(se,{key:0,ref_key:"upImageRef",ref:S,action:F(C)+"api/v1/system/upload/singleImg",modelValue:F(D),"onUpdate:modelValue":d[0]||(d[0]=g=>E(D)?D.value=g:null),limit:10},null,8,["action","modelValue"])):f.value==="file"?(m(),L(ie,{key:1,ref_key:"upFileRef",ref:l,action:F(C)+"api/v1/system/upload/singleFile",modelValue:F(u),"onUpdate:modelValue":d[1]||(d[1]=g=>E(u)?u.value=g:null),limit:10,uploadSize:50},null,8,["action","modelValue"])):f.value==="bigFile"?(m(),L(Ue,{key:2,ref_key:"upBigFileRef",ref:x,modelValue:F(u),"onUpdate:modelValue":d[2]||(d[2]=g=>E(u)?u.value=g:null),limit:10},null,8,["modelValue"])):b("",!0)]),_:1},8,["modelValue"])])}}}),Ft=ue(De,[["__scopeId","data-v-fac3c318"]]);export{Ft as default};
