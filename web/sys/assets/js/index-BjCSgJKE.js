import{d as ne,b as m,Z as ie,_ as de,j as pe,e as me,o as b,c as ce,U as e,O as t,u as n,D as ue,P as _e,i as fe,ai as a,a as I,S as i,T as we,M as S,R as he,ae as N,V as ve}from"./@vue-CIdpUgdv.js";import De from"./editRole-Bp-Yuxdf.js";import be from"./dataScope-BUhs3PWs.js";import{g as Re,d as ge,s as ye}from"./index-DV5EhVUG.js";import{g as ke,a as Se}from"./index-Bt4iVw3F.js";import{_ as Ce}from"./userList.vue_vue_type_script_setup_true_lang-DDGkQb7b.js";import{s as Le}from"./index-CbMIc7j8.js";import{E as Ve,a as xe,d as Ue}from"./element-plus-BcbsnzDt.js";import{a as Ae}from"./index-Cf93PWEY.js";import"./editUser.vue_vue_type_script_setup_true_lang-1RFyqaXj.js";import"./@element-plus-jSNvwxF2.js";import"./lodash-es-1chB_st9.js";import"./@vueuse-Dw_h8qVP.js";import"./@popperjs-D9SI2xQl.js";import"./@ctrl-r5W6hzzQ.js";import"./dayjs-BB1_x23Y.js";import"./@intlify-BrbEMGpa.js";import"./async-validator-DKvM95Vc.js";import"./memoize-one-BdPwpGay.js";import"./normalize-wheel-es-B6fDCfyv.js";import"./@floating-ui-DSOXY3Ah.js";import"./pinia-DE-bJcb2.js";import"./vue-demi-Dq6ymT-8.js";import"./vue-router-CWOL7ATe.js";import"./js-cookie-Cz0CWeBA.js";import"./nprogress-ekFNJb3B.js";import"./axios-CdtiCRuU.js";import"./qs-Cbync0Ql.js";import"./side-channel-Bxu5bNZA.js";import"./get-intrinsic-BKEvijrG.js";import"./es-errors-DzOT6E3C.js";import"./has-symbols-eVqrYdw7.js";import"./has-proto-JnoBQRdH.js";import"./function-bind-BbkWVFrm.js";import"./hasown-DYqjtFKE.js";import"./call-bind-Bt3bzbWQ.js";import"./set-function-length-B5OANX0j.js";import"./define-data-property-DO9o5wXF.js";import"./es-define-property-tzmkNPou.js";import"./gopd-CEkvUycD.js";import"./has-property-descriptors-DphFXkuo.js";import"./object-inspect-C4zVfScY.js";import"./vue-i18n-C6ZazF2L.js";import"./vue-BUaMJYO7.js";import"./vue-clipboard3-B4JKg9Nx.js";import"./clipboard-UlwKUFeW.js";import"./mitt-DJ65BbbF.js";import"./vue-grid-layout-CBs1MJUm.js";import"./vue-simple-uploader-DfJosV98.js";import"./vue-ueditor-wrap-DRzi_KnA.js";const Ee={class:"system-role-container"},Be={class:"system-user-search mb15"},Ie={class:"el-dropdown-link"},Ne=ne({name:"apiV1SystemRoleList",__name:"index",setup(Oe){const C=m(),{proxy:R}=fe(),{sys_user_sex:O}=R.useDict("sys_user_sex");m();const L=m(),g=m(),V=m(),x=m(),h=m([]),U=m(0),d=ie({isShowDialog:!1,deptData:[],userListParam:{roleId:void 0},selectRow:{},tableData:{data:[],total:0,loading:!1,param:{roleName:"",roleStatus:"",pageNum:1,pageSize:10}}}),{tableData:u,selectRow:T,deptData:P,userListParam:$,isShowDialog:v}=de(d),z=()=>{_()},_=()=>{const o=[];Re(d.tableData.param).then(l=>{(l.data.list??[]).map(s=>{o.push({id:s.id,pid:s.pid,status:s.status,listOrder:s.listOrder,name:s.name,remark:s.remark,dataScope:s.dataScope,userCnt:s.userCnt,createdAt:s.createdAt})}),x.value=o,d.tableData.data=R.handleTree(o??[],"id","pid","children",!0)})},M=o=>{d.selectRow=o,d.userListParam.roleId=o.id,d.deptData.length==0?ke().then(l=>{d.deptData=l.data.deps,d.isShowDialog=!0}):d.isShowDialog=!0},F=()=>{g.value.openDialog()},A=o=>{g.value.openDialog(N(o))},G=o=>{V.value.openDialog(N(o))},j=o=>{const l=Ue.service();U.value=o.id,Se(o.id).then(p=>{l.close(),h.value=p.data.userList?p.data.userList.map(s=>s.id):[],C.value.openDialog()})},Z=o=>{Ve.confirm(`此操作将永久删除角色：“${o.name}”，是否继续?`,"提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(()=>{ge(o.id).then(()=>{xe.success("删除成功"),R.$refs.editRoleRef.resetMenuSession(),_()})}).catch(()=>{})},q=()=>{L.value.userList()};pe(()=>{z()});const H=o=>{var s,f;let l=o.split("_"),p=(f=(s=x.value)==null?void 0:s.filter(y=>y.id==parseInt(l[1])))==null?void 0:f[0];switch(l[0]){case"resource":A(p);break;case"data":G(p);break;case"user":j(p);break}};me(h,o=>{J(o)});const J=o=>{ye({roleId:U.value,userIds:o}).then(l=>{_()})};return(o,l)=>{const p=a("el-input"),s=a("el-form-item"),f=a("el-option"),y=a("el-select"),K=a("ele-Search"),w=a("el-icon"),D=a("el-button"),Q=a("ele-FolderAdd"),W=a("el-form"),c=a("el-table-column"),X=a("el-link"),E=a("el-tag"),Y=a("ele-EditPen"),ee=a("ele-ArrowDown"),k=a("el-dropdown-item"),te=a("el-dropdown-menu"),oe=a("el-dropdown"),ae=a("ele-DeleteFilled"),le=a("el-table"),se=a("el-card"),re=a("el-dialog");return b(),ce("div",Ee,[e(se,{shadow:"hover"},{default:t(()=>[I("div",Be,[e(W,{inline:!0},{default:t(()=>[e(s,{label:"角色名称"},{default:t(()=>[e(p,{modelValue:n(u).param.roleName,"onUpdate:modelValue":l[0]||(l[0]=r=>n(u).param.roleName=r),placeholder:"请输入角色名称",class:"w-50 m-2",clearable:""},null,8,["modelValue"])]),_:1}),e(s,{label:"状态"},{default:t(()=>[e(y,{placeholder:"请选择状态",class:"w-50 m-2",modelValue:n(u).param.roleStatus,"onUpdate:modelValue":l[1]||(l[1]=r=>n(u).param.roleStatus=r),clearable:"",style:{width:"120px"}},{default:t(()=>[e(f,{label:"启用",value:"1"}),e(f,{label:"禁用",value:"0"})]),_:1},8,["modelValue"])]),_:1}),e(s,null,{default:t(()=>[e(D,{size:"default",type:"primary",class:"ml10",onClick:_},{default:t(()=>[e(w,null,{default:t(()=>[e(K)]),_:1}),i(" 查询 ")]),_:1}),e(D,{size:"default",type:"success",class:"ml10",onClick:F},{default:t(()=>[e(w,null,{default:t(()=>[e(Q)]),_:1}),i(" 新增角色 ")]),_:1})]),_:1})]),_:1})]),e(le,{data:n(u).data,style:{width:"100%"},"row-key":"id","default-expand-all":"","tree-props":{children:"children",hasChildren:"hasChildren"}},{default:t(()=>[e(c,{prop:"name",label:"角色名称","show-overflow-tooltip":""}),e(c,{prop:"listOrder",label:"排序","show-overflow-tooltip":""}),e(c,{prop:"userCnt",label:"用户数量",align:"center"},{default:t(r=>[e(X,{type:"primary",onClick:B=>M(r.row)},{default:t(()=>[i(we(r.row.userCnt),1)]),_:2},1032,["onClick"])]),_:1}),e(c,{prop:"status",label:"角色状态","show-overflow-tooltip":""},{default:t(r=>[r.row.status===1?(b(),S(E,{key:0,type:"success"},{default:t(()=>[i("启用")]),_:1})):(b(),S(E,{key:1,type:"info"},{default:t(()=>[i("禁用")]),_:1}))]),_:1}),e(c,{prop:"remark",label:"角色描述","show-overflow-tooltip":""}),e(c,{prop:"createdAt",label:"创建时间","show-overflow-tooltip":""}),e(c,{label:"操作",width:"220"},{default:t(r=>[e(D,{size:"small",text:"",type:"primary",onClick:B=>A(r.row)},{default:t(()=>[e(w,null,{default:t(()=>[e(Y)]),_:1}),i("修改")]),_:2},1032,["onClick"]),e(oe,{class:"auth-action",onCommand:H},{dropdown:t(()=>[e(te,{class:"auth-action-menu"},{default:t(()=>[e(k,{command:"resource_"+r.row.id},{default:t(()=>[i("资源权限")]),_:2},1032,["command"]),e(k,{command:"data_"+r.row.id},{default:t(()=>[i("数据权限")]),_:2},1032,["command"]),e(k,{command:"user_"+r.row.id},{default:t(()=>[i("用户授权")]),_:2},1032,["command"])]),_:2},1024)]),default:t(()=>[I("span",Ie,[i(" 授权 "),e(w,null,{default:t(()=>[e(ee)]),_:1})])]),_:2},1024),e(D,{size:"small",text:"",type:"primary",onClick:B=>Z(r.row)},{default:t(()=>[e(w,null,{default:t(()=>[e(ae)]),_:1}),i("删除")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1}),e(De,{ref_key:"editRoleRef",ref:g,onGetRoleList:_,roleData:n(u).data},null,8,["roleData"]),e(be,{ref_key:"dataScopeRef",ref:V,onGetRoleList:_},null,512),e(re,{title:n(T).name+"-用户列表",modelValue:n(v),"onUpdate:modelValue":l[2]||(l[2]=r=>ue(v)?v.value=r:null),width:"70vw"},{default:t(()=>[n(v)?(b(),S(Ce,{key:0,ref_key:"userListRef",ref:L,"dept-data":n(P),"gender-data":n(O),param:n($),onGetUserList:q},null,8,["dept-data","gender-data","param"])):he("",!0)]),_:1},8,["title","modelValue"]),_e(e(Le,{ref_key:"selectUserRef",ref:C,modelValue:h.value,"onUpdate:modelValue":l[3]||(l[3]=r=>h.value=r)},null,8,["modelValue"]),[[ve,!1]])])}}}),Bt=Ae(Ne,[["__scopeId","data-v-bcb2864f"]]);export{Bt as default};
