import{d as re,b as E,Z as ue,_ as ie,o as N,c as I,U as e,O as t,u as a,D as g,ai as m,i as pe,a as Y,S as r,T as D,R as fe,P as b,V as R}from"./@vue-CIdpUgdv.js";import{a as ce,b as _e,c as ge,e as ye}from"./index-DV5EhVUG.js";import{l as xe,a as ke}from"./index-Cf93PWEY.js";import{a as H}from"./element-plus-BcbsnzDt.js";import"./pinia-DE-bJcb2.js";import"./vue-demi-Dq6ymT-8.js";import"./vue-router-CWOL7ATe.js";import"./js-cookie-Cz0CWeBA.js";import"./@element-plus-jSNvwxF2.js";import"./nprogress-ekFNJb3B.js";import"./@intlify-BrbEMGpa.js";import"./axios-CdtiCRuU.js";import"./qs-Cbync0Ql.js";import"./side-channel-Bxu5bNZA.js";import"./get-intrinsic-BKEvijrG.js";import"./es-errors-DzOT6E3C.js";import"./has-symbols-eVqrYdw7.js";import"./has-proto-JnoBQRdH.js";import"./function-bind-BbkWVFrm.js";import"./hasown-DYqjtFKE.js";import"./call-bind-Bt3bzbWQ.js";import"./set-function-length-B5OANX0j.js";import"./define-data-property-DO9o5wXF.js";import"./es-define-property-tzmkNPou.js";import"./gopd-CEkvUycD.js";import"./has-property-descriptors-DphFXkuo.js";import"./object-inspect-C4zVfScY.js";import"./vue-i18n-C6ZazF2L.js";import"./vue-BUaMJYO7.js";import"./vue-clipboard3-B4JKg9Nx.js";import"./clipboard-UlwKUFeW.js";import"./mitt-DJ65BbbF.js";import"./vue-grid-layout-CBs1MJUm.js";import"./vue-simple-uploader-DfJosV98.js";import"./vue-ueditor-wrap-DRzi_KnA.js";import"./lodash-es-1chB_st9.js";import"./@vueuse-Dw_h8qVP.js";import"./@popperjs-D9SI2xQl.js";import"./@ctrl-r5W6hzzQ.js";import"./dayjs-BB1_x23Y.js";import"./async-validator-DKvM95Vc.js";import"./memoize-one-BdPwpGay.js";import"./normalize-wheel-es-B6fDCfyv.js";import"./@floating-ui-DSOXY3Ah.js";const Ve={class:"system-edit-role-container"},ve={key:0},he={class:"dialog-footer"},De=re({name:"systemEditRole",__name:"editRole",props:{roleData:{type:Array,default:()=>[]}},emits:["getRoleList"],setup(A,{expose:K,emit:L}){const C=L,{proxy:O}=pe(),w=E(null),c=E(),n=ue({loading:!1,isShowDialog:!1,formData:{id:0,pid:0,name:"",status:1,listOrder:0,remark:"",menuIds:[],effectiveType:0,weekDay:[1,2,3,4,5],dayRange:["2024-02-01 08:00:00","2024-02-01 19:00:00"],dateRange:[]},rules:{name:[{required:!0,message:"角色名称不能为空",trigger:"blur"}]},menuData:[],menuExpand:!1,menuNodeAll:!1,menuCheckStrictly:!1,menuProps:{children:"children",label:"title",disabled:"disabled"}}),P=s=>{F(),q(),s&&ce(s.id).then(l=>{l.data.role&&(n.formData=l.data.role,n.formData.weekDay||(n.formData.weekDay=[1,2,3,4,5]),n.formData.menuIds=l.data.menuIds??[])}),n.isShowDialog=!0},y=()=>{n.isShowDialog=!1},B=()=>{y()},z=()=>{const s=a(w);s&&s.validate(l=>{l&&(n.loading=!0,n.formData.menuIds=$(),n.formData.id===0?ge(n.formData).then(()=>{H.success("角色添加成功"),y(),v(),C("getRoleList")}).finally(()=>{n.loading=!1}):ye(n.formData).then(()=>{H.success("角色修改成功"),y(),v(),C("getRoleList")}).finally(()=>{n.loading=!1}))})},q=()=>{_e().then(s=>{const l=s.data.menu??[],f=s.data.accessMenus??[];l.map(u=>{u.disabled=!f.includes(u.id)}),n.menuData=O.handleTree(l,"id","pid")})},F=()=>{n.menuCheckStrictly=!1,n.menuExpand=!1,n.menuNodeAll=!1,n.formData={id:0,pid:0,name:"",status:1,listOrder:0,remark:"",menuIds:[],effectiveType:0,weekDay:[1,2,3,4,5],dayRange:["2024-02-01 08:00:00","2024-02-01 19:00:00"],dateRange:[]}},{formData:d,menuData:W,menuExpand:x,menuNodeAll:k,menuCheckStrictly:_,menuProps:Z,rules:j,loading:G,isShowDialog:V}=ie(n),J=s=>{let l=n.menuData;for(let f=0;f<l.length;f++)c.value.store.nodesMap[l[f].id].expanded=s},Q=s=>{c.value.setCheckedNodes(s?n.menuData:[])},X=s=>{n.menuCheckStrictly=!!s};function $(){let s=c.value.getCheckedKeys(),l=c.value.getHalfCheckedKeys();return s.unshift.apply(s,l),s}const v=()=>{xe()};return K({openDialog:P,resetMenuSession:v}),(s,l)=>{const f=m("el-cascader"),u=m("el-form-item"),i=m("el-col"),S=m("el-input"),ee=m("el-input-number"),le=m("el-switch"),h=m("el-radio"),te=m("el-radio-group"),p=m("el-checkbox"),ae=m("el-checkbox-group"),oe=m("el-time-picker"),de=m("el-date-picker"),ne=m("el-tree"),U=m("el-row"),se=m("el-form"),T=m("el-button"),me=m("el-dialog");return N(),I("div",Ve,[e(me,{title:(a(d).id===0?"添加":"修改")+"角色",modelValue:a(V),"onUpdate:modelValue":l[15]||(l[15]=o=>g(V)?V.value=o:null),width:"769px"},{footer:t(()=>[Y("span",he,[e(T,{onClick:B,size:"default"},{default:t(()=>[r("取 消")]),_:1}),e(T,{type:"primary",onClick:z,size:"default",loading:a(G)},{default:t(()=>[r(D(a(d).id===0?"新 增":"修 改"),1)]),_:1},8,["loading"])])]),default:t(()=>[e(se,{ref_key:"formRef",ref:w,model:a(d),rules:a(j),size:"default","label-width":"90px"},{default:t(()=>[e(U,{gutter:35},{default:t(()=>[e(i,{xs:24,sm:24,md:24,lg:24,xl:24},{default:t(()=>[e(u,{label:"上级角色"},{default:t(()=>[e(f,{options:A.roleData,props:{checkStrictly:!0,emitPath:!1,value:"id",label:"name"},placeholder:"请选择上级",clearable:"",class:"w100",modelValue:a(d).pid,"onUpdate:modelValue":l[0]||(l[0]=o=>a(d).pid=o)},{default:t(({node:o,data:M})=>[Y("span",null,D(M.name),1),o.isLeaf?fe("",!0):(N(),I("span",ve," ("+D(M.children.length)+") ",1))]),_:1},8,["options","modelValue"])]),_:1})]),_:1}),e(i,{xs:24,sm:12,md:12,lg:12,xl:12},{default:t(()=>[e(u,{label:"角色名称",prop:"name"},{default:t(()=>[e(S,{modelValue:a(d).name,"onUpdate:modelValue":l[1]||(l[1]=o=>a(d).name=o),placeholder:"请输入角色名称",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(i,{xs:24,sm:12,md:12,lg:12,xl:12},{default:t(()=>[e(u,{label:"排序"},{default:t(()=>[e(ee,{modelValue:a(d).listOrder,"onUpdate:modelValue":l[2]||(l[2]=o=>a(d).listOrder=o),min:0,"controls-position":"right",placeholder:"请输入排序",class:"w100"},null,8,["modelValue"])]),_:1})]),_:1}),e(i,{xs:24,sm:12,md:12,lg:12,xl:12},{default:t(()=>[e(u,{label:"角色状态"},{default:t(()=>[e(le,{modelValue:a(d).status,"onUpdate:modelValue":l[3]||(l[3]=o=>a(d).status=o),"active-value":1,"inactive-value":0,"inline-prompt":"","active-text":"启","inactive-text":"禁"},null,8,["modelValue"])]),_:1})]),_:1}),e(i,{xs:24,sm:24,md:24,lg:24,xl:24},{default:t(()=>[e(u,{label:"角色描述"},{default:t(()=>[e(S,{modelValue:a(d).remark,"onUpdate:modelValue":l[4]||(l[4]=o=>a(d).remark=o),type:"textarea",placeholder:"请输入角色描述",maxlength:"150"},null,8,["modelValue"])]),_:1})]),_:1}),e(i,{xs:24,sm:24,md:24,lg:24,xl:24},{default:t(()=>[e(u,{label:"有效时间"},{default:t(()=>[e(te,{modelValue:a(d).effectiveType,"onUpdate:modelValue":l[5]||(l[5]=o=>a(d).effectiveType=o)},{default:t(()=>[e(h,{value:0},{default:t(()=>[r("不设置")]),_:1}),e(h,{value:1},{default:t(()=>[r("按起止日期")]),_:1}),e(h,{value:2},{default:t(()=>[r("按时间段")]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),b(e(i,{xs:24,sm:24,md:24,lg:24,xl:24},{default:t(()=>[e(u,{label:"每周"},{default:t(()=>[e(ae,{modelValue:a(d).weekDay,"onUpdate:modelValue":l[6]||(l[6]=o=>a(d).weekDay=o)},{default:t(()=>[e(p,{value:1},{default:t(()=>[r("周一")]),_:1}),e(p,{value:2},{default:t(()=>[r("周二")]),_:1}),e(p,{value:3},{default:t(()=>[r("周三")]),_:1}),e(p,{value:4},{default:t(()=>[r("周四")]),_:1}),e(p,{value:5},{default:t(()=>[r("周五")]),_:1}),e(p,{value:6},{default:t(()=>[r("周六")]),_:1}),e(p,{value:0},{default:t(()=>[r("周日")]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},512),[[R,a(d).effectiveType===2]]),b(e(i,{xs:24,sm:24,md:24,lg:24,xl:24},{default:t(()=>[e(u,{label:"时间段",style:{width:"360px"}},{default:t(()=>[e(oe,{modelValue:a(d).dayRange,"onUpdate:modelValue":l[7]||(l[7]=o=>a(d).dayRange=o),"is-range":"",format:"HH:mm:ss","value-format":"YYYY-MM-DD HH:mm:ss","range-separator":"至","start-placeholder":"开始时间","end-placeholder":"截止时间"},null,8,["modelValue"])]),_:1})]),_:1},512),[[R,a(d).effectiveType===2]]),b(e(i,{xs:24,sm:24,md:24,lg:24,xl:24},{default:t(()=>[e(u,{label:"起止日期",style:{width:"450px"}},{default:t(()=>[e(de,{modelValue:a(d).dateRange,"onUpdate:modelValue":l[8]||(l[8]=o=>a(d).dateRange=o),"value-format":"YYYY-MM-DD HH:mm:ss",type:"datetimerange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期"},null,8,["modelValue"])]),_:1})]),_:1},512),[[R,a(d).effectiveType===1]]),e(i,{xs:24,sm:24,md:24,lg:24,xl:24},{default:t(()=>[e(u,{label:"菜单权限"},{default:t(()=>[e(U,{gutter:35},{default:t(()=>[e(i,{xs:24,sm:24,md:24,lg:24,xl:24},{default:t(()=>[e(p,{modelValue:a(x),"onUpdate:modelValue":l[9]||(l[9]=o=>g(x)?x.value=o:null),onChange:l[10]||(l[10]=o=>J(o))},{default:t(()=>[r("展开/折叠")]),_:1},8,["modelValue"]),e(p,{modelValue:a(k),"onUpdate:modelValue":l[11]||(l[11]=o=>g(k)?k.value=o:null),onChange:l[12]||(l[12]=o=>Q(o))},{default:t(()=>[r("全选/全不选")]),_:1},8,["modelValue"]),e(p,{modelValue:a(_),"onUpdate:modelValue":l[13]||(l[13]=o=>g(_)?_.value=o:null),onChange:l[14]||(l[14]=o=>X(o))},{default:t(()=>[r("父子联动")]),_:1},8,["modelValue"])]),_:1}),e(i,{xs:24,sm:24,md:24,lg:24,xl:24},{default:t(()=>[e(ne,{data:a(W),ref_key:"menuRef",ref:c,props:a(Z),"default-checked-keys":a(d).menuIds,"node-key":"id","show-checkbox":"",class:"menu-data-tree tree-border","check-strictly":!a(_)},null,8,["data","props","default-checked-keys","check-strictly"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"])])}}}),cl=ke(De,[["__scopeId","data-v-890dd55d"]]);export{cl as default};
