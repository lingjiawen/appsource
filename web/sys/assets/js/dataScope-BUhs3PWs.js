import{d as we,b as n,Z as Ce,o as f,c as C,U as a,O as l,n as J,ai as d,i as Ve,a as V,S as u,T as y,F as K,a8 as Z,M as L,R as Se,P as De,V as xe}from"./@vue-CIdpUgdv.js";import{r as Te,a as Ie,f as Re,h as Ne}from"./index-DV5EhVUG.js";import{a as j}from"./element-plus-BcbsnzDt.js";import{a as Ue}from"./index-Cf93PWEY.js";import"./lodash-es-1chB_st9.js";import"./@vueuse-Dw_h8qVP.js";import"./@element-plus-jSNvwxF2.js";import"./@popperjs-D9SI2xQl.js";import"./@ctrl-r5W6hzzQ.js";import"./dayjs-BB1_x23Y.js";import"./@intlify-BrbEMGpa.js";import"./async-validator-DKvM95Vc.js";import"./memoize-one-BdPwpGay.js";import"./normalize-wheel-es-B6fDCfyv.js";import"./@floating-ui-DSOXY3Ah.js";import"./pinia-DE-bJcb2.js";import"./vue-demi-Dq6ymT-8.js";import"./vue-router-CWOL7ATe.js";import"./js-cookie-Cz0CWeBA.js";import"./nprogress-ekFNJb3B.js";import"./axios-CdtiCRuU.js";import"./qs-Cbync0Ql.js";import"./side-channel-Bxu5bNZA.js";import"./get-intrinsic-BKEvijrG.js";import"./es-errors-DzOT6E3C.js";import"./has-symbols-eVqrYdw7.js";import"./has-proto-JnoBQRdH.js";import"./function-bind-BbkWVFrm.js";import"./hasown-DYqjtFKE.js";import"./call-bind-Bt3bzbWQ.js";import"./set-function-length-B5OANX0j.js";import"./define-data-property-DO9o5wXF.js";import"./es-define-property-tzmkNPou.js";import"./gopd-CEkvUycD.js";import"./has-property-descriptors-DphFXkuo.js";import"./object-inspect-C4zVfScY.js";import"./vue-i18n-C6ZazF2L.js";import"./vue-BUaMJYO7.js";import"./vue-clipboard3-B4JKg9Nx.js";import"./clipboard-UlwKUFeW.js";import"./mitt-DJ65BbbF.js";import"./vue-grid-layout-CBs1MJUm.js";import"./vue-simple-uploader-DfJosV98.js";import"./vue-ueditor-wrap-DRzi_KnA.js";const Ae={class:"system-sysJob-edit"},Be={class:"ml10"},Ke={class:"option-con"},Le={key:1},Me={class:"dialog-footer"},Oe={class:"dialog-footer"},Ee=we({name:"dataScope",__name:"dataScope",emits:["getRoleList"],setup(Pe,{expose:q,emit:G}){const Q=G,S=n(),D=n(!1),{proxy:x}=Ve(),b=n(!1),M=n(!0),O=n(!1),T=n([]);n([]);const _=n(),W=n(),h=n(!1),E=n("0"),I=n(0),X=n({children:"children",label:"deptName"}),P=n([{value:1,label:"全部"},{value:3,label:"本部门"},{value:4,label:"本部门及以下"},{value:5,label:"仅本人"},{value:2,label:"自定义"}]),r=n([]),m=n([]),i=Ce({roleId:void 0,roleName:"",authData:[{menuId:"0",scope:"0",deptIds:[]}]}),U=n([]),g=n([]),Y=o=>{let e=T.value;for(let s=0;s<e.length;s++)_.value.store.nodesMap[e[s].deptId].expanded=o},ee=o=>{_.value.setCheckedNodes(o?T.value:[])},te=o=>{h.value=!!o},le=()=>{i.authData=[],S.value.getSelectionRows().map(e=>{let s=e.id;i.authData.push({menuId:s,scope:r.value[s],deptIds:m.value[s]??[]})}),Ne(i).then(e=>{e.code===0?(j.success("设置成功"),b.value=!1,Q("getRoleList")):j.error("设置失败")})},oe=()=>{ue()},ae=()=>{m.value[I.value]=R(),A()},ne=()=>{R(),m.value[I.value]=R(),x.findChildrenByPid(I.value,g.value).map(e=>{m.value[e.id]=R()}),A()},A=()=>{h.value=!1,D.value=!1};q({openDialog:o=>{b.value=!0,Te().then(e=>{T.value=e.data.depts||[]}),re(),o&&(Ie(o.id).then(e=>{e.data.role&&(i.roleName=e.data.role.name,i.roleId=e.data.role.id)}),se(o.id))}});const de=o=>{J(()=>{var e;(e=_.value)==null||e.setCheckedKeys([],!1),m.value[o]&&_.value.setCheckedKeys(m.value[o],!0)})},se=o=>{Re(o).then(e=>{U.value=x.handleTree(e.data.rules??[],"id","pid"),g.value=x.flattenTree(U.value);const s=[],p=[],N=[];e.data.dataScope&&(e.data.dataScope.map(c=>{s[c.menuId]=c.dataScope,p[c.menuId]=c.deptIds}),r.value=s,m.value=p,g.value.map(c=>{r.value[c.id]&&N.push(c)}),J(()=>{N.map(c=>{S.value.toggleRowSelection(c,!0)})}))})},ue=()=>{b.value=!1},R=()=>_.value.getCheckedKeys(),re=()=>{i.roleId=void 0,i.roleName="",i.authData=[],h.value=!1,r.value=[],m.value=[]},ie=o=>{},pe=o=>{g.value.map(e=>{r.value[e.id]=o})},ce=(o,e)=>{const s=x.findChildrenByPid(e,g.value);g.value.some(p=>p.id==e?(s.unshift(p),!0):!1),s.map(p=>{S.value.toggleRowSelection(p,!0)}),s.map(p=>{r.value[p.id]=o})},me=o=>{D.value=!0,I.value=o,de(o)},ve=o=>m.value[o]?m.value[o].length:0;return(o,e)=>{const s=d("el-alert"),p=d("el-input"),N=d("el-form-item"),c=d("el-form"),k=d("el-table-column"),fe=d("SvgIcon"),_e=d("el-tag"),F=d("el-radio"),H=d("el-radio-group"),he=d("el-badge"),ge=d("el-link"),ye=d("el-table"),w=d("el-button"),z=d("el-dialog"),B=d("el-checkbox"),$=d("el-col"),be=d("el-tree"),ke=d("el-row");return f(),C("div",Ae,[a(z,{title:"数据权限设置",modelValue:b.value,"onUpdate:modelValue":e[2]||(e[2]=t=>b.value=t),width:"90%","append-to-body":"","close-on-click-modal":!1},{footer:l(()=>[V("div",Me,[a(w,{type:"primary",onClick:le},{default:l(()=>[u("确 定")]),_:1}),a(w,{onClick:oe},{default:l(()=>[u("取 消")]),_:1})])]),default:l(()=>[a(s,{title:"注：此功能界面需要与代码查询条件配合使用，并非所有接口都需设置数据权限，多用于业务模块！",closable:!1,type:"warning",style:{"margin-bottom":"12px"}}),a(c,{ref_key:"formRef",ref:W,model:i,"label-width":"80px"},{default:l(()=>[a(N,{label:"角色名称"},{default:l(()=>[a(p,{modelValue:i.roleName,"onUpdate:modelValue":e[0]||(e[0]=t=>i.roleName=t),disabled:!0},null,8,["modelValue"])]),_:1})]),_:1},8,["model"]),a(ye,{ref_key:"tableRef",ref:S,data:U.value,style:{width:"100%"},"row-key":"path","tree-props":{children:"children",hasChildren:"hasChildren"},onSelectionChange:ie},{default:l(()=>[a(k,{type:"selection",width:"55"}),a(k,{label:"菜单名称"},{default:l(t=>[a(fe,{name:t.row.icon},null,8,["name"]),V("span",Be,y(t.row.title),1)]),_:1}),a(k,{label:"api接口"},{default:l(t=>[V("span",null,y(t.row.name),1)]),_:1}),a(k,{label:"类型","show-overflow-tooltip":"",width:"80"},{default:l(t=>[a(_e,{type:t.row.menuType===0?"danger":t.row.menuType===1?"success":"warning",size:"small"},{default:l(()=>[u(y(t.row.menuType===0?"目录":t.row.menuType===1?"菜单":"按钮"),1)]),_:2},1032,["type"])]),_:1}),a(k,{label:"操作",width:"600"},{header:l(()=>[a(H,{modelValue:E.value,"onUpdate:modelValue":e[1]||(e[1]=t=>E.value=t),onChange:pe},{default:l(()=>[(f(!0),C(K,null,Z(P.value,t=>(f(),C(K,{key:t.value},[t.value.toString()!="2"?(f(),L(F,{key:0,value:t.value},{default:l(()=>[u(y(t.label),1)]),_:2},1032,["value"])):Se("",!0)],64))),128))]),_:1},8,["modelValue"])]),default:l(t=>[V("div",Ke,[a(H,{modelValue:r.value[t.row.id],"onUpdate:modelValue":v=>r.value[t.row.id]=v},{default:l(()=>[(f(!0),C(K,null,Z(P.value,v=>(f(),L(F,{key:v.value,value:v.value,onChange:He=>ce(v.value,t.row.id)},{default:l(()=>[v.value.toString()=="2"&&r.value[t.row.id]=="2"?(f(),L(he,{key:0,type:"success",value:ve(t.row.id),max:99,class:"item","show-zero":!1},{default:l(()=>[u(y(v.label),1)]),_:2},1032,["value"])):(f(),C("span",Le,y(v.label),1))]),_:2},1032,["value","onChange"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"]),De(a(ge,{type:"primary",onClick:v=>me(t.row.id),underline:!1},{default:l(()=>[u("选择部门")]),_:2},1032,["onClick"]),[[xe,r.value[t.row.id]&&r.value[t.row.id]=="2"]])])]),_:1})]),_:1},8,["data"])]),_:1},8,["modelValue"]),a(z,{title:"选择部门",modelValue:D.value,"onUpdate:modelValue":e[9]||(e[9]=t=>D.value=t),width:"800px","append-to-body":"","close-on-click-modal":!1},{footer:l(()=>[V("div",Oe,[a(w,{type:"primary",onClick:ae},{default:l(()=>[u("确 定")]),_:1}),a(w,{type:"success",onClick:ne},{default:l(()=>[u("确定并应用到子菜单")]),_:1}),a(w,{onClick:A},{default:l(()=>[u("取 消")]),_:1})])]),default:l(()=>[a(ke,{gutter:35},{default:l(()=>[a($,{xs:24,sm:24,md:24,lg:24,xl:24},{default:l(()=>[a(B,{modelValue:M.value,"onUpdate:modelValue":e[3]||(e[3]=t=>M.value=t),onChange:e[4]||(e[4]=t=>Y(t))},{default:l(()=>[u("展开/折叠")]),_:1},8,["modelValue"]),a(B,{modelValue:O.value,"onUpdate:modelValue":e[5]||(e[5]=t=>O.value=t),onChange:e[6]||(e[6]=t=>ee(t))},{default:l(()=>[u("全选/全不选")]),_:1},8,["modelValue"]),a(B,{modelValue:h.value,"onUpdate:modelValue":e[7]||(e[7]=t=>h.value=t),onChange:e[8]||(e[8]=t=>te(t))},{default:l(()=>[u("父子联动")]),_:1},8,["modelValue"])]),_:1}),a($,{xs:24,sm:24,md:24,lg:24,xl:24,class:"mb20"},{default:l(()=>[a(be,{class:"tree-border",data:T.value,"show-checkbox":"","default-expand-all":"",ref_key:"deptRef",ref:_,"node-key":"deptId","check-strictly":!h.value,props:X.value},null,8,["data","check-strictly","props"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}}),At=Ue(Ee,[["__scopeId","data-v-590e4156"]]);export{At as default};
